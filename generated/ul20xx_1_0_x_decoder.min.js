function stringFromUTF8Array(e){for(var t=[1,1,1,1,2,2,3,0],r=e.length,a="",i=0;i<r;){var n=e[i++];if(128&n){var s=t[n>>3&7];if(!(64&n)||!s||i+s>r)return null;for(n&=63>>s;s>0;s-=1){var o=e[i++];if(128!=(192&o))return null;n=n<<6|63&o}}a+=String.fromCharCode(n)}return a}function BitExtract(e){this.data=e,this.offset=0}function BinaryExtract(e){this.buffer=e,this.offset=0}function pad(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}function intToHexStr(e,t){return pad(e.toString(16).toUpperCase(),t)}function bytesToHexStr(e){for(var t="",r=0;r<e.length;r+=1)t+=("00"+e[r].toString(16)).slice(-2).toUpperCase();return t}function bitFalseTrue(e){return{value:!!e}}function profileReason(e,t){if(e<240)return e;switch(e){case 247:return"calendar_active";case 248:return"init_active";case 249:return"profile_not_active";case 254:return"value_differ";case 246:return"driver_not_found";case 250:return"ldr_input_active";case 252:return"dig_input_active";case 253:return"manual_active";case 255:return"unknown";default:return t.errors.push("invalid_reason"),"invalid_reason"}}function addressParse(e,t,r){return 1===e?{value:"analog_0_10v",raw:e}:254===e?{value:"dali_broadcast",raw:e}:255===e?t?{value:t,raw:e}:(r.warnings.push("invalid_address"),{value:"invalid",raw:e}):1&e?(r.warnings.push("invalid_address"),{value:"invalid",raw:e}):128&e?{value:"dali_group_"+(e>>1&15).toString(),raw:e}:{value:"dali_single_"+(e>>1&63).toString(),raw:e}}function profileParserPartial(e,t,r){var a=e.getUint8();t.profile_id={value:255===a?"no_profile":a,raw:a};var i=e.getUint8();t.profile_version={value:profileReason(i,r),raw:i};var n=e.getUint8();t.address=addressParse(n,null,r);var s=e.getUint8(),o=new BitExtract(s),u=[];return o.getBits(1)&&u.push("holiday"),o.getBits(1)&&u.push("mon"),o.getBits(1)&&u.push("tue"),o.getBits(1)&&u.push("wed"),o.getBits(1)&&u.push("thu"),o.getBits(1)&&u.push("fri"),o.getBits(1)&&u.push("sat"),o.getBits(1)&&u.push("sun"),t.days_active={value:u,raw:s},0}function decodeUnixEpoch(e,t){var r=new Date(1e3*e).toISOString();return e<1420070400&&(r="invalid_timestamp",t.warnings.push("invalid_timestamp")),{value:r,raw:e}}function decodeLdrConfig(e,t){t.packet_type={value:"ldr_input_config_packet"};var r=e.getUint8();t.ldr_off_threshold_high={value:255===r?"disabled":r,raw:r};var a=e.getUint8();t.ldr_on_threshold_low={value:255===a?"disabled":a,raw:a};var i=e.getUint8Bits();i.getBits(2),t.trigger_alert_enabled=bitFalseTrue(i.getBits(1))}function decodeDimmingLevel(e,t){return 255===e?{value:t,raw:e,unit:""}:{value:e,raw:e,unit:"%"}}function decodeDigConfig(e,t,r){t.packet_type={value:"dig_input_config_packet"};var a=e.getUint16();t.light_on_duration={value:65535===a?"dig_input_disabled":a,raw:a,unit:"s"};var i=e.getUint8Bits();i.getBits(1);var n=i.getBits(1),s=i.getBits(1);t.signal_edge_rising=bitFalseTrue(n),t.trigger_alert_enabled=bitFalseTrue(s);var o=e.getUint8();t.address=addressParse(o,null,r);var u=e.getUint8();t.dimming_level=decodeDimmingLevel(u,"disabled")}function decodeStepTime(e){var t=10*e,r=Math.trunc(t/60),a=t-60*r;return{value:pad(r,2)+":"+pad(a,2),raw:t}}function decodeOdRelaySwStep(e){var t={};t.step_time=decodeStepTime(e.getUint8());var r=0!==e.getUint8();return t.open_drain_output_on=bitFalseTrue(r),t}function decodeCalendarConfigV10(e,t){t.packet_type={value:"calendar_config_packet"};var r=e.getInt8(),a=e.getInt8(),i=e.getInt16()/100,n=e.getInt16()/100,s=-1===r&&-1===a;t.sunrise_offset={value:s?"disabled":r,unit:"min",raw:r},t.sunset_offset={value:s?"disabled":a,unit:"min",raw:a},t.latitude={value:i,unit:"째"},t.longitude={value:n,unit:"째"}}function decodeStatusConfig(e,t){t.packet_type={value:"status_config_packet"};var r=e.getUint32();t.staus_interval={value:r,unit:"s"}}function decodeDimmingStep(e){var t={};t.step_time=decodeStepTime(e.getUint8());var r=e.getUint8();return t.dimming_level=decodeDimmingLevel(r,"inactive"),t}function decodeProfileConfig(e,t,r){for(t.packet_type={value:"profile_config_packet"},profileParserPartial(e,t,r),t.dimming_steps=[];e.availableLen();)t.dimming_steps.push(decodeDimmingStep(e))}function decodeTimeConfig(e,t,r){t.packet_type={value:"time_config_packet"};var a=e.getUint32();t.device_unix_epoch=decodeUnixEpoch(a,r)}function decodeLegacyDefaultsConfig(e,t){t.packet_type={value:"legacy_defaults_config_packet"};var r=e.getUint8();t.default_dim={value:r,unit:"%"};var a=e.getUint8Bits();t.ldr_alert_enabled=bitFalseTrue(a.getBits(1)),a.getBits(1),t.dig_alert_enabled=bitFalseTrue(a.getBits(1)),t.dali_alert_enabled=bitFalseTrue(a.getBits(1))}function decodeUsageConfig(e,t){t.packet_type={value:"usage_config_packet"};var r=e.getUint32(),a=e.getUint8();t.usage_interval={value:r,unit:"s"},255!==a&&(t.mains_voltage={value:a,unit:"V"})}function decodeMonthDay(e){var t=e.getUint8(),r=e.getUint8();return{value:pad(t,2)+"/"+pad(r,2),raw:t<<8|r}}function decodeHolidayConfig(e,t){for(t.packet_type={value:"holiday_config_packet"},t.holidays=[];e.availableLen();)t.holidays.push(decodeMonthDay(e))}function decodeBootDelayConfig(e,t){t.packet_type={value:"boot_delay_config_packet"};var r=1===e.availableLen()?e.getUint8():e.getUint16();t.boot_delay_range={value:r,unit:"s"}}function decodeFade(e,t){var r="",a="";return 255===e?a="ignore":e>=16?(a="invalid_fade",t.errors.push("invalid_fade")):(r="s",a=[.5,.71,1,1.41,2,2.83,4,5.66,8,11.31,16,22.63,32,45.25,64,90.51][e]),{value:a,unit:r,raw:e}}function decodeDefaultsConfig(e,t,r){t.packet_type={value:"defaults_config_packet"};var a=e.getUint8Bits(),i=a.getBits(1),n=a.getBits(1),s=a.getBits(1),o=a.getBits(1),u=a.getBits(1);if(i){var l=e.getUint8();t.default_dim={value:l,unit:"%"}}if(n){var d=e.getUint8();t.max_dim={value:255===d?"default":d,unit:"%",raw:d}}if(s){var c=e.getUint8();t.fade_duration=decodeFade(c,r)}if(o){var _=e.getUint8Bits().getBits(1);t.switch_point_sunset={value:_?"sunset":"twilight",raw:_}}if(u){var g=e.getUint8Bits().getBits(1);t.legacy_mode_enabled=bitFalseTrue(g)}}function decodeLocationConfigV10(e,t){t.packet_type={value:"location_config_packet"};var r=e.getUint8Bits(),a=r.getBits(1),i=r.getBits(1);if(a&&(t.latitude={value:e.getInt32()/1e7,unit:"째"},t.longitude={value:e.getInt32()/1e7,unit:"째"}),i){var n=e.getUint8();t.address={value:e.getTextUtf8(n)}}}function decodeLedConfig(e,t){t.packet_type={value:"onboard_led_config_packet"};var r=e.getUint8Bits().getBits(1);t.status_led_enabled=bitFalseTrue(r)}function alertParamConfig(e,t,r){var a={value:e===t?"alert_off":e,raw:e};return r&&(a.unit=e===t?"":r),a}function decodeMeteringAlertConfig(e,t,r){if(t.packet_type={value:"metering_alert_config_packet"},1===e.getUint8()){var a=e.getUint16(),i=e.getUint16(),n=e.getUint16(),s=e.getUint16(),o=e.getUint8();t.min_power=alertParamConfig(a,65535,"W"),t.max_power=alertParamConfig(i,65535,"W"),t.min_voltage=alertParamConfig(n,65535,"V"),t.max_voltage=alertParamConfig(s,65535,"V"),t.min_power_factor={value:255===o?"alert_off":o/100,raw:o}}else r.errors.push("invalid_header")}function decodeMulticastConfig(e,t,r){t.packet_type={value:"multicast_config_packet"};var a=e.getUint8();if(0===a||a>4)r.errors.push("invalid_multicast_device");else{t.multicast_device={value:a};var i=e.getRaw(4).reverse();t.devaddr={value:bytesToHexStr(i)};var n=e.getRaw(16);t.nwkskey={value:bytesToHexStr(n)};var s=e.getRaw(16);t.appskey={value:bytesToHexStr(s)}}}function decodeClearConfig(e,t,r){switch(t.packet_type={value:"clear_config_packet"},e.getUint8()){case 1:t.reset_target={value:"ldr_input_config"};break;case 3:t.reset_target={value:"dig_input_config"};break;case 4:if(t.reset_target={value:"profile_config"},t.address=addressParse(e.getUint8(),"all_profiles",r),e.availableLen()){var a=e.getUint8();t.profile_id={value:a}}break;case 6:t.reset_target={value:"holiday_config"};break;case 82:t.reset_target={value:"multicast_config"};var i=e.getUint8();t.multicast_device={value:255===i?"all_multicast_devices":"multicast_device_"+i,raw:i};break;case 255:t.reset_target={value:"factory_reset"},t.device_serial={value:intToHexStr(e.getUint32(),8)};break;default:r.errors.push("invalid_clear_config_target")}}function decodeFport50(e,t,r){switch(e.getUint8()){case 1:return void decodeLdrConfig(e,t);case 3:return void decodeDigConfig(e,t,r);case 5:for(t.packet_type={value:"open_drain_output_config_packet"},t.switching_steps=[];e.availableLen();)t.switching_steps.push(decodeOdRelaySwStep(e));return;case 7:return void decodeStatusConfig(e,t);case 9:return void decodeTimeConfig(e,t,r);case 11:return void decodeUsageConfig(e,t);case 13:return void decodeBootDelayConfig(e,t);case 21:return void decodeLedConfig(e,t);case 22:return void decodeMeteringAlertConfig(e,t,r);case 82:return void decodeMulticastConfig(e,t,r);case 255:return void decodeClearConfig(e,t,r);case 6:return void decodeCalendarConfigV10(e,t);case 8:return void decodeProfileConfig(e,t,r);case 10:return void decodeLegacyDefaultsConfig(e,t);case 12:return void decodeHolidayConfig(e,t);case 14:return void decodeDefaultsConfig(e,t,r);case 19:return void decodeLocationConfigV10(e,t);default:r.errors.push("invalid_header")}}function daliStatus(e,t,r){var a={driver_error:bitFalseTrue(!1),lamp_failure:bitFalseTrue(!1),lamp_on:bitFalseTrue(!1),limit_error:bitFalseTrue(!1),fade_running:bitFalseTrue(!1),reset_state:bitFalseTrue(!1),missing_short_address:bitFalseTrue(!1),power_failure:bitFalseTrue(!1)};if(255===e.data)return a;var i=e.getBits(1);a.driver_error=bitFalseTrue(i);var n=e.getBits(1);a.lamp_failure=bitFalseTrue(n),a.lamp_on=bitFalseTrue(e.getBits(1));var s=e.getBits(1);a.limit_error=bitFalseTrue(s),a.fade_running=bitFalseTrue(e.getBits(1));var o=e.getBits(1);a.reset_state=bitFalseTrue(o);var u=e.getBits(1);a.missing_short_address=bitFalseTrue(u);var l=e.getBits(1);return a.power_failure=bitFalseTrue(l),i&&r.warnings.push(t+" driver_error"),n&&r.warnings.push(t+" lamp_failure"),s&&r.warnings.push(t+" limit_error"),o&&r.warnings.push(t+" reset_state"),l&&r.warnings.push(t+" power_failure"),a}function decodeDaliStatus(e,t){var r={},a=addressParse(e.getUint8(),null,t);return r.address=a,r.status=daliStatus(e.getUint8Bits(),a.value,t),r}function decodeDaliStatusReq(e,t,r){if(t.packet_type={value:"dali_status_request"},1===e.availableLen()){var a=e.getUint8();t.address=254===a?{value:"all_drivers",raw:a}:addressParse(a,null,r)}else for(t.dali_statuses=[];e.availableLen();)t.dali_statuses.push(decodeDaliStatus(e,r))}function decodeDimming(e,t){var r={},a=e.getUint8();r.address=addressParse(a,null,t);var i=e.getUint8();return r.dimming_level=decodeDimmingLevel(i,"resume"),r}function decodeDimmingCommand(e,t,r){for(t.packet_type={value:"manual_dimming"},t.destination=[];e.availableLen();)t.destination.push(decodeDimming(e,r))}function decodeCustomDaliReq(e,t,r){t.packet_type={value:"custom_dali_request"};var a=e.offset;if(t.query_data_raw={value:bytesToHexStr(e.getRaw(e.availableLen()))},e.offset=a,e.availableLen()>3)e.getRaw(e.availableLen());else{var i=e.getUint8();t.address=addressParse(i,null,r);var n=e.getUint8();if(t.dali_query={value:n},1===e.availableLen()){var s=e.getUint8();t.dali_response={value:s}}}}function decodeCustomDaliCommand(e,t){t.packet_type={value:"custom_dali_command"};var r=e.getRaw(e.availableLen());t.dali_command={value:bytesToHexStr(r)}}function decodeStatusRequest(e,t,r){t.packet_type={value:"status_usage_request"};var a=e.getUint8Bits();t.usage_requested=bitFalseTrue(a.getBits(1)),t.status_requested=bitFalseTrue(a.getBits(1))}function decodeDigVal(e){return 0===e?"off":1===e?"on":255===e?"n/a":"invalid_value"}function decodeInterfacesRequest(e,t,r){if(1===e.availableLen())return e.getUint8(),void(t.packet_type={value:"interface_request"});t.packet_type={value:"interface_request"};var a=e.getUint8(),i=e.getUint8(),n=e.getUint8(),s=e.getUint8(),o=e.getUint8();e.getUint8();var u=e.getUint8(),l=e.getUint8Bits();1===a&&2===n&&3===o&&4===u?(t.dig={value:decodeDigVal(i),raw:i},t.ldr={value:255===s?"n/a":s,raw:s},t.internal_relay_closed=bitFalseTrue(l.getBits(1)),t.open_drain_output_on=bitFalseTrue(l.getBits(1))):r.errors.push("invalid_interface")}function decodeDriverMemoryPartial(e,t,r){var a=e.getUint8();t.address=addressParse(a,null,r);var i=e.getUint8();t.memory_bank={value:i};var n=e.getUint8();t.memory_address={value:n}}function decodeDriverMemoryPartialSized(e,t,r){decodeDriverMemoryPartial(e,t,r);var a=e.getUint8();return t.read_size={value:a,unit:"bytes"},a}function decodeReadDriverMemory(e,t,r){if(t.packet_type={value:"driver_memory_read"},0!==e.availableLen()){var a=decodeDriverMemoryPartialSized(e,t,r);if(e.availableLen()){var i=e.getRaw(a);t.memory_value={value:bytesToHexStr(i)}}}else r.warnings.push("driver_memory_read_failed")}function decodeWriteDriverMemory(e,t,r){if(t.packet_type={value:"driver_memory_write"},0!==e.availableLen()){decodeDriverMemoryPartial(e,t);var a=e.getRaw(e.availableLen());t.memory_value={value:bytesToHexStr(a)}}else r.warnings.push("driver_memory_write_failed")}function decodeTimedDimming(e,t){var r={},a=e.getUint8();r.address=addressParse(a,null,t);var i=e.getUint8();r.dimming_level=decodeDimmingLevel(i,"resume");var n=e.getUint8();return r.duration={value:n,unit:"min"},r}function decodeTimedDimmingCommand(e,t,r){for(t.packet_type={value:"manual_timed_dimming"},t.destination=[];e.availableLen();)t.destination.push(decodeTimedDimming(e,r))}function decodeOpenDrainSwitching(e,t){t.packet_type={value:"open_drain_output_control"};var r=e.getUint8Bits().getBits(1);t.open_drain_output_on=bitFalseTrue(r)}function decodeFport60(e,t,r){switch(e.getUint8()){case 1:return void decodeDimmingCommand(e,t,r);case 3:return void decodeCustomDaliReq(e,t,r);case 4:return void decodeCustomDaliCommand(e,t);case 5:return void decodeStatusRequest(e,t);case 7:return void decodeReadDriverMemory(e,t,r);case 8:return void decodeWriteDriverMemory(e,t,r);case 9:return void decodeTimedDimmingCommand(e,t,r);case 12:return void decodeOpenDrainSwitching(e,t);case 0:return void decodeDaliStatusReq(e,t,r);case 6:return void decodeInterfacesRequest(e,t,r);default:r.errors.push("invalid_command")}}function statusProfileParser(e,t){var r={};profileParserPartial(e,r,t);var a=e.getUint8();return r.dimming_level=decodeDimmingLevel(a,"resume"),r}function statusParser1_0(e,t,r){t.packet_type={value:"status_packet"};var a=e.getUint32();t.device_unix_epoch=decodeUnixEpoch(a,r);var i={},n=e.getUint8Bits(),s=n.getBits(1),o=n.getBits(1),u=n.getBits(1);n.getBits(1);var l=n.getBits(1),d=n.getBits(1);n.getBits(1);var c=n.getBits(1);i.dali_error_external=bitFalseTrue(s),s&&r.warnings.push("dali_external_error"),i.dali_connection_error=bitFalseTrue(o),o&&r.warnings.push("dali_connection_error"),i.hardware_error=bitFalseTrue(d),d&&r.warnings.push("hardware_error"),i.internal_relay_closed=bitFalseTrue(c),i.ldr_input_on=bitFalseTrue(u),i.dig_input_on=bitFalseTrue(l),t.status=i,t.downlink_rssi={value:-1*e.getUint8(),unit:"dBm"},t.downlink_snr={value:e.getInt8(),unit:"dB"},t.mcu_temperature={value:e.getInt8(),unit:"째C"};var _={},g=e.getUint8Bits();g.getBits(1);var v=g.getBits(1),f=g.getBits(1);for(g.getBits(1),t.status.open_drain_output_on=bitFalseTrue(f),_.voltage_alert_in_24h=bitFalseTrue(g.getBits(1)),_.lamp_error_alert_in_24h=bitFalseTrue(g.getBits(1)),_.power_alert_in_24h=bitFalseTrue(g.getBits(1)),_.power_factor_alert_in_24h=bitFalseTrue(g.getBits(1)),t.analog_interfaces=_,v&&(t.ldr_input_value={value:e.getUint8()}),t.profiles=[];e.availableLen();)t.profiles.push(statusProfileParser(e,r))}function usageConsumptionParse(e,t){var r={},a=e.getUint8();r.address=addressParse(a,"internal_measurement",t);var i=e.getUint8Bits();if(i.getBits(1)&&(r.active_energy={value:e.getUint32(),unit:"Wh"}),i.getBits(1)&&(r.active_power={value:e.getUint16(),unit:"W"}),i.getBits(1)&&(r.load_side_energy={value:e.getUint32(),unit:"Wh"}),i.getBits(1)&&(r.load_side_power={value:e.getUint16(),unit:"W"}),i.getBits(1)){var n=e.getUint8();r.power_factor={value:255===n?"unknown":n/100,raw:n}}return i.getBits(1)&&(r.mains_voltage={value:e.getUint8(),unit:"V"}),i.getBits(1)&&(r.driver_operating_time={value:e.getUint32(),unit:"s"}),i.getBits(1)&&(r.lamp_on_time={value:e.getUint32(),unit:255===a?"h":"s"}),r}function usageParser(e,t,r){for(t.packet_type={value:"usage_packet"},t.consumption=[];e.availableLen();)t.consumption.push(usageConsumptionParse(e,r))}function deviceConfigParser(e,t){switch(e){case 0:return"dali";case 1:return"dali_nc";case 2:return"dali_no";case 3:return"analog_nc";case 4:return"analog_no";case 5:return"dali_analog_nc";case 6:return"dali_analog_no";case 7:return"dali_analog_nc_no";default:return t.errors.push("invalid_device_config"),"invalid_config"}}function optionalFeaturesParser(e){var t={},r=new BitExtract(e);return r.getBits(1),r.getBits(1),t.dig_input=bitFalseTrue(r.getBits(1)),t.ldr_input=bitFalseTrue(r.getBits(1)),t.open_drain_output=bitFalseTrue(r.getBits(1)),t.metering=bitFalseTrue(r.getBits(1)),r.getBits(1),r.getBits(1),t}function daliSupplyParse(e,t){var r=e;if(r<112)return{value:r,raw:r,unit:"V"};switch(e){case 126:return{value:"bus_high",raw:r};case 127:return t.warnings.push("dali_bus_error"),{value:"bus_error",raw:r};default:return{value:"invalid_value",raw:r}}}function resetReasonParse(e,t){var r=[],a=new BitExtract(e);return a.getBits(1)&&r.push("reset_0"),a.getBits(1)&&(r.push("watchdog_reset"),t.warnings.push("watchdog_reset")),a.getBits(1)&&r.push("soft_reset"),a.getBits(1)&&r.push("reset_3"),a.getBits(1)&&r.push("reset_4"),a.getBits(1)&&r.push("reset_5"),a.getBits(1)&&r.push("reset_6"),a.getBits(1)&&r.push("reset_7"),r}function bootParser(e,t,r){t.packet_type={value:"boot_packet"},t.device_serial={value:intToHexStr(e.getUint32(),8)};var a=e.getUint8(),i=e.getUint8(),n=e.getUint8();t.firmware_version={value:a+"."+i+"."+n,raw:a<<16|i<<8|n};var s=e.getUint32();t.device_unix_epoch=decodeUnixEpoch(s,r);var o=e.getUint8();t.device_config={value:deviceConfigParser(o,r),raw:o};var u=e.getUint8();t.optional_features=optionalFeaturesParser(u);var l=e.getUint8Bits();t.dali_supply_state=daliSupplyParse(l.getBits(7),r);var d=l.getBits(1);t.dali_power_source_external={value:d?"external":"internal",raw:d};var c=e.getUint8Bits();t.dali_addressed_driver_count={value:c.getBits(7)};var _=c.getBits(1);if(t.dali_unadressed_driver_found=bitFalseTrue(_),_&&r.warnings.push("unadressed_dali_driver_on_bus"),e.availableLen()){var g=e.getUint8();t.reset_reason={value:resetReasonParse(g,r),raw:g}}}function errorCodeParser(e){switch(e){case 0:case 1:return"n/a";case 2:return"unknown_fport";case 3:return"packet_size_short";case 4:return"packet_size_long";case 5:return"value_error";case 6:return"protocol_parse_error";case 7:return"reserved_flag_set";case 8:return"invalid_flag_combination";case 9:return"unavailable_feature_request";case 10:return"unsupported_header";case 11:return"unreachable_hw_request";case 12:return"address_not_available";case 13:return"internal_error";case 14:return"packet_size_error";case 129:return"profile_id_seq_error";case 130:return"profile_destination_eror";case 131:return"profile_days_error";case 132:return"profile_step_count_error";case 133:return"profile_step_value_error";case 134:return"profile_step_unsorted_error";default:return"invalid_error_code"}}function configFailedParser(e,t,r){t.packet_type={value:"invalid_downlink_packet"},t.downlink_from_fport={value:e.getUint8()};var a=e.getUint8(),i=errorCodeParser(a);t.error_reason={value:i,raw:a},r.warnings.push("downlink_"+i)}function decodeFport99(e,t,r){switch(e.getUint8()){case 0:return void bootParser(e,t,r);case 19:return void configFailedParser(e,t,r);default:r.errors.push("invalid_header")}}function decodeFport61(e,t,r){var a=e.getUint8(),i=e.getUint8(),n=i>>4;switch(a){case 128:if(t.packet_type={value:"dig_input_alert"},2!==n)return void r.errors.push("invalid_packet_length");r.warnings.push("dig_input_alert");var s=e.getUint16();return void(t.dig_input_event_counter={value:s});case 129:if(t.packet_type={value:"ldr_input_alert"},2!==n)return void r.errors.push("invalid_packet_length");r.warnings.push("ldr_input_alert");var o=e.getUint8Bits().getBits(1),u=e.getUint8();return t.ldr_input_on=bitFalseTrue(o),void(t.ldr_input_value={value:u});case 131:for(t.packet_type={value:"dali_driver_alert"},t.drivers=[];e.availableLen();)t.drivers.push(decodeDaliStatus(e,r));return;case 132:t.packet_type={value:"metering_alert"};var l=new BitExtract(i),d=l.getBits(1),c=l.getBits(1),_=l.getBits(1),g=l.getBits(1),v=l.getBits(1);t.lamp_error_alert=bitFalseTrue(d),t.over_current_alert=bitFalseTrue(c),t.under_voltage_alert=bitFalseTrue(_),t.over_voltage_alert=bitFalseTrue(g),t.low_power_factor_alert=bitFalseTrue(v),d&&r.warnings.push("metering_lamp_error"),c&&r.warnings.push("metering_over_current"),_&&r.warnings.push("metering_under_voltage"),g&&r.warnings.push("metering_over_voltage"),v&&r.warnings.push("metering_low_power_factor");var f=e.getUint16();t.power={value:f,unit:"W"};var p=e.getUint16();t.voltage={value:p,unit:"V"};var m=e.getUint8()/100;return void(t.power_factor={value:m});default:r.errors.push("invalid_header")}}function decodeFport49(e,t,r){switch(e.getUint8()){case 1:return void(t.packet_type={value:"ldr_input_config_request"});case 3:return void(t.packet_type={value:"dig_input_config_request"});case 7:return void(t.packet_type={value:"status_config_request"});case 9:return void(t.packet_type={value:"time_config_packet"});case 11:return void(t.packet_type={value:"usage_config_request"});case 13:return void(t.packet_type={value:"boot_delay_config_request"});case 21:return void(t.packet_type={value:"onboard_led_config_request"});case 22:return void(t.packet_type={value:"metering_alert_confic_request"});case 82:t.packet_type={value:"multicast_config_request"};var a=e.getUint8();return void(t.multicast_device={value:255===a?"all":a,raw:a});case 6:return void(t.packet_type={value:"calendar_config_request"});case 8:t.packet_type={value:"profile_config_request"};var i=e.getUint8();return void(t.profile_id={value:255===i?"all_profiles":i,raw:i});case 10:return void(t.packet_type={value:"default_dim_config_request"});case 12:return void(t.packet_type={value:"holiday_config_request"});case 14:return void(t.packet_type={value:"defaults_config_request"});case 19:return void(t.packet_type={value:"location_config_request"});default:r.errors.push("invalid_header")}}function decodeFport51(e,t,r){255!==e.getUint8()?r.errors.push("invalid_command"):t.packet_type={value:"activate_dfu_command"}}function decodeByFport(e,t,r,a){var i=new BinaryExtract(t);0===i.availableLen()?a.errors.push("empty_payload"):24===e?statusParser1_0(i,r,a):25===e?usageParser(i,r,a):49===e?decodeFport49(i,r,a):50===e?decodeFport50(i,r,a):51===e?decodeFport51(i,r,a):60===e?decodeFport60(i,r,a):61===e?decodeFport61(i,r,a):99===e?decodeFport99(i,r,a):a.errors.push("invalid_fport"),0!==i.availableLen()&&a.errors.push("invalid_payload_length_long")}function decodeRaw(e,t){var r={},a={errors:[],warnings:[]};try{decodeByFport(e,t,r,a)}catch(e){a.errors.push(e.message)}var i={data:r};return a.errors.length&&(i.errors=a.errors),a.warnings.length&&(i.warnings=a.warnings),i}function formatElementStrValueUnit(e,t){var r=e.toString();t.length>0&&(isNaN(+r)||(r=r+" "+t));return r}function convertObjRecursive(e,t){if(e.constructor===Object){if("value"in e){var r=e.value,a="unit"in e?e.unit:"";return t(r,a)}var i={};for(var n in e)void 0!==e[n]&&e[n]&&(i[n]=convertObjRecursive(e[n],t));return i}if(e instanceof Array){var s=[];return e.forEach((function(e){s.push(convertObjRecursive(e,t))})),s}return e}function convertObjToFormatted(e,t){var r={};for(var a in e)void 0!==e[a]&&e[a]&&(r[a]=convertObjRecursive(e[a],t));return r}function decodeDownlink(e){return convertObjToFormatted(decodeRaw(e.fPort,e.bytes),formatElementStrValueUnit)}function decodeUplink(e){return convertObjToFormatted(decodeRaw(e.fPort,e.bytes),formatElementStrValueUnit)}function Decoder(e,t){return convertObjToFormatted(decodeRaw(t,e),formatElementStrValueUnit)}function Decode(e,t){return convertObjToFormatted(decodeRaw(e,t),formatElementStrValueUnit)}BitExtract.prototype._assertOnRemainingLength=function(e){if(0===e)throw Error("invalid zero length bit field");if(this.offset+e>8)throw Error("invalid number of bits extracted")},BitExtract.prototype.getBits=function(e){this._assertOnRemainingLength(e);var t=Math.pow(2,e)-1,r=this.data>>this.offset&t;return this.offset+=e,1===e?Boolean(r):r},BinaryExtract.prototype.availableLen=function(){return this.buffer.length-this.offset},BinaryExtract.prototype._assertOnRemainingLength=function(e){if(e>this.availableLen())throw Error("invalid buffer length: too short")},BinaryExtract.prototype.getUint8=function(){return this._assertOnRemainingLength(1),this.buffer[this.offset++]},BinaryExtract.prototype.getInt8=function(){var e=this.getUint8();return e>127?e-256:e},BinaryExtract.prototype.getUint16=function(){return this._assertOnRemainingLength(2),this.buffer[this.offset++]+256*this.buffer[this.offset++]},BinaryExtract.prototype.getInt16=function(){var e=this.getUint16();return e>32767?e-65536:e},BinaryExtract.prototype.getUint24=function(){return this._assertOnRemainingLength(3),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]},BinaryExtract.prototype.getUint32=function(){return this._assertOnRemainingLength(4),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]+16777216*this.buffer[this.offset++]},BinaryExtract.prototype.getInt32=function(){var e=this.getUint32();return e>2147483647?e-4294967296:e},BinaryExtract.prototype.getUint64=function(){return this.getUint32()+4294967296*this.getUint32()},BinaryExtract.prototype.getTextUtf8=function(e){this._assertOnRemainingLength(e);var t=stringFromUTF8Array(this.buffer.slice(this.offset,this.offset+e));return this.offset+=e,t},BinaryExtract.prototype.getUint8Bits=function(){return new BitExtract(this.getUint8())},BinaryExtract.prototype.getRaw=function(e){this._assertOnRemainingLength(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},BinaryExtract.prototype.getFloat=function(){var e=this.getUint32(),t=2147483648&e?-1:1,r=(e>>23&255)-127,a=8388607&e;if(128===r)return t*(a?Number.NaN:Number.POSITIVE_INFINITY);if(-127===r){if(0===a)return 0*t;r=-126,a/=1<<22}else a=(a|1<<23)/(1<<23);return t*a*Math.pow(2,r)};
