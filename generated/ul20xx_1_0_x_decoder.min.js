function stringFromUTF8Array(e){for(var t=[1,1,1,1,2,2,3,0],r=e.length,a="",i=0;i<r;){var n=e[i++];if(128&n){var s=t[n>>3&7];if(!(64&n)||!s||i+s>r)return null;for(n&=63>>s;s>0;s-=1){var o=e[i++];if(128!=(192&o))return null;n=n<<6|63&o}}a+=String.fromCharCode(n)}return a}function BitExtract(e){this.data=e,this.offset=0}function BinaryExtract(e){this.buffer=e,this.offset=0}function pad(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}function intToHexStr(e,t){return pad(e.toString(16).toUpperCase(),t)}function bytesToHexStr(e){for(var t="",r=0;r<e.length;r+=1)t+=("00"+e[r].toString(16)).slice(-2).toUpperCase();return t}function bitFalseTrue(e){return{value:!!e}}function profileOverrideReason(e){switch(e){case 246:return"driver_not_found";case 247:return"calendar_active";case 248:return"init_active";case 249:return"profile_not_active";case 250:return"ldr_active";case 251:return"thr_active";case 252:return"dig_active";case 253:return"manual_active";case 254:return"value_differ";case 255:return"unknown";default:return"none"}}function daliAddressParse(e,t,r){return 254===e?{value:"broadcast",raw:e}:255===e?t?{value:t,raw:e}:(r.warnings.push("invalid_dali_address"),{value:"invalid",raw:e}):1&e?(r.warnings.push("invalid_dali_address"),{value:"invalid",raw:e}):128&e?{value:"group "+(e>>1&15).toString(),raw:e}:{value:"single "+(e>>1&63).toString(),raw:e}}function profileParserPartial(e,t,r){var a=e.getUint8(),i=e.getUint8(),n=e.getUint8(),s=e.getUint8();t.profile_id={value:255===a?"no_profile":a,raw:a},t.profile_version={value:i>240?"n/a":i,raw:i},t.profile_override={value:profileOverrideReason(i),raw:i},t.dali_address_short=daliAddressParse(n,null,r);var o=new BitExtract(s),u=[];o.getBits(1)&&u.push("holiday"),o.getBits(1)&&u.push("mon"),o.getBits(1)&&u.push("tue"),o.getBits(1)&&u.push("wed"),o.getBits(1)&&u.push("thu"),o.getBits(1)&&u.push("fri"),o.getBits(1)&&u.push("sat"),o.getBits(1)&&u.push("sun"),t.days_active={value:u,raw:s}}function decodeUnixEpoch(e){var t=new Date(1e3*e),r=t.toISOString();return e<946684800?r="invalid_timestamp":e<1420070400&&(r="P"+pad(t.getUTCFullYear()-2e3,4)+"-"+pad(t.getUTCMonth(),2)+"-"+pad(t.getUTCDate()-1,2)+"T"+pad(t.getUTCHours(),2)+":"+pad(t.getUTCMinutes(),2)+":"+pad(t.getUTCSeconds(),2)),{value:r,raw:e}}function decodeLdrConfig(e,t){t.packet_type={value:"ldr_config_packet"};var r=e.getUint8();t.switch_threshold_high={value:255===r?"disabled":r,raw:r};var a=e.getUint8();t.switch_threshold_low={value:255===a?"disabled":a,raw:a};var i=e.getUint8Bits();i.getBits(2),t.switch_trigger_alert_enabled=bitFalseTrue(i.getBits(1))}function decodeDigConfig(e,t,r){t.packet_type={value:"dig_config_packet"};var a=e.getUint16();t.switch_time={value:65535===a?"disabled":a,raw:a,unit:"s"};var i=e.getUint8Bits();i.getBits(1);var n=i.getBits(1);t.switch_transition={value:n?"enabled":"disabled",raw:n},t.switch_trigger_alert_enabled=bitFalseTrue(i.getBits(1));var s=e.getUint8();t.dali_address_short=daliAddressParse(s,null,r);var o=e.getUint8();t.dimming_level={value:o,unit:"%"}}function decodeStepTime(e,t){var r=10*e,a=Math.trunc(r/60),i=r-60*a;t.step_time={value:pad(a,2)+":"+pad(i,2),raw:r}}function decodeOdRelaySwStep(e){var t={};decodeStepTime(e.getUint8(),t);var r=0!==e.getUint8();return t.open_drain_out_state=bitFalseTrue(r),t}function decodeCalendarConfig(e,t){t.packet_type={value:"calendar_config_packet"};var r=e.getInt8(),a=e.getInt8(),i=e.getInt16()/100,n=e.getInt16()/100,s=-1===r&&-1===a;t.sunrise_offset={value:s?"disabled":r,unit:"min",raw:r},t.sunset_offset={value:s?"disabled":a,unit:"min",raw:a},t.latitude={value:i,unit:"°"},t.longitude={value:n,unit:"°"}}function decodeStatusConfig(e,t){t.packet_type={value:"status_config_packet"};var r=e.getUint32();t.staus_interval={value:r,unit:"s"}}function decodeDimmingStep(e){var t=e.getUint8(),r=e.getUint8(),a={};return decodeStepTime(t,a),a.dimming_level={value:r,unit:"%"},a}function decodeProfileConfig(e,t,r){for(t.packet_type={value:"profile_config_packet"},profileParserPartial(e,t,r),t.dimming_steps=[];e.availableLen();)t.dimming_steps.push(decodeDimmingStep(e))}function decodeTimeConfig(e,t){t.packet_type={value:"time_config_packet"};var r=e.getUint32();t.device_unix_epoch=decodeUnixEpoch(r)}function decodeLegacyDefaultsConfig(e,t){t.packet_type={value:"legacy_defaults_config_packet"};var r=e.getUint8();t.default_dim={value:r,unit:"%"};var a=e.getUint8Bits();t.ldr_alert_enabled=bitFalseTrue(a.getBits(1)),a.getBits(1),t.dig_alert_enabled=bitFalseTrue(a.getBits(1)),t.dali_alert_enabled=bitFalseTrue(a.getBits(1))}function decodeUsageConfig(e,t){t.packet_type={value:"usage_config_packet"};var r=e.getUint32(),a=e.getUint8();t.usage_interval={value:r,unit:"s"},t.mains_voltage={value:a,unit:"V"}}function decodeHolidayConfig(e,t){for(t.packet_type={value:"holiday_config_packet"},t.holidays=[];e.availableLen();){var r=e.getUint8(),a=e.getUint8();t.holidays.push({value:pad(r,2)+"-"+pad(a,2),raw:r<<8|a})}}function decodeBootDelayConfig(e,t){t.packet_type={value:"boot_delay_config_packet"};var r=1===e.availableLen()?e.getUint8():e.getUint16();t.boot_delay_range={value:r,unit:"s"}}function decodeFade(e){var t=e>16?"invalid_fade":[.5,.71,1,1.41,2,2.83,4,5.66,8,11.31,16,22.63,32,45.25,64,90.51][e];return 255===e&&(t="ignore"),{value:t,unit:"s",raw:e}}function decodeDefaultsConfig(e,t){t.packet_type={value:"defaults_config_packet"};var r=e.getUint8Bits(),a=r.getBits(1),i=r.getBits(1),n=r.getBits(1),s=r.getBits(1),o=r.getBits(1);if(a){var u=e.getUint8();t.default_dim={value:u,unit:"%"}}if(i){var l=e.getUint8();t.max_dim={value:255===l?"default":l,unit:"%",raw:l}}if(n){var d=e.getUint8();t.fade_duration=decodeFade(d)}if(s){var c=e.getUint8Bits().getBits(1);t.switch_point_sunset={value:c?"sunset":"twilight",raw:c}}if(o){var _=e.getUint8Bits().getBits(1);t.legacy_mode_enabled=bitFalseTrue(_)}}function decodeLocationConfig(e,t){t.packet_type={value:"location_config_packet"};var r=e.getUint8Bits(),a=r.getBits(1),i=r.getBits(1);if(a&&(t.position_latitude={value:e.getInt32()/1e7,unit:"°"},t.position_longitude={value:e.getInt32()/1e7,unit:"°"}),i){var n=e.getUint8();t.address={value:e.getTextUtf8(n)}}}function decodeLedConfig(e,t){t.packet_type={value:"led_config_packet"};var r=e.getUint8Bits().getBits(1);t.status_led_enabled=bitFalseTrue(r)}function alertParamConfig(e,t,r){var a={value:e===t?"alert_off":e,raw:e};return r&&(a.unit=e===t?"":r),a}function decodeMeteringAlertConfig(e,t,r){if(t.packet_type={value:"metering_alert_config_packet"},1===e.getUint8()){var a=e.getUint16(),i=e.getUint16(),n=e.getUint16(),s=e.getUint16(),o=e.getUint8();t.min_power=alertParamConfig(a,65535,"W"),t.max_power=alertParamConfig(i,65535,"W"),t.min_voltage=alertParamConfig(n,65535,"V"),t.max_voltage=alertParamConfig(s,65535,"V"),t.min_power_factor={value:255===o?"alert_off":o/100,raw:o}}else r.errors.push("invalid_header")}function decodeMulticastConfig(e,t,r){t.packet_type={value:"multicast_config_packet"};var a=e.getUint8();if(0===a||a>4)r.errors.push("invalid_multicast_device");else{t.multicast_device={value:a};var i=e.getRaw(4).reverse();t.device_address={value:bytesToHexStr(i)};var n=e.getRaw(16);t.network_security_key={value:bytesToHexStr(n)};var s=e.getRaw(16);t.application_security_key={value:bytesToHexStr(s)}}}function decodeClearConfig(e,t,r){switch(t.packet_type={value:"clear_config_packet"},e.getUint8()){case 1:t.reset_target="ldr_config";break;case 3:t.reset_target="dig_config";break;case 4:t.reset_target="profile_config";var a=e.getUint8();if(t.dali_address_short=daliAddressParse(a,"all_profiles",r),e.availableLen()){var i=e.getUint8();t.profile_id={value:255===i?"all_used_profiles":i,raw:i}}break;case 6:t.reset_target="holiday_config";break;case 82:t.reset_target="multicast_config";var n=e.getUint8();t.multicast_device={value:255===n?"all_multicast_devices":n,raw:n};break;case 255:t.reset_target="factory_reset";var s=e.getRaw(4);t.device_serial={value:bytesToHexStr(s)};break;default:r.errors.push("invalid_clear_config_target")}}function decodeFport50(e,t,r){var a=new BinaryExtract(e);switch(a.getUint8()){case 1:return void decodeLdrConfig(a,t);case 3:return void decodeDigConfig(a,t,r);case 5:for(t.packet_type={value:"open_drain_out_config_packet"},t.switching_steps=[];a.availableLen();)t.switching_steps.push(decodeOdRelaySwStep(a));return;case 6:return void decodeCalendarConfig(a,t);case 7:return void decodeStatusConfig(a,t);case 8:return void decodeProfileConfig(a,t,r);case 9:return void decodeTimeConfig(a,t);case 10:return void decodeLegacyDefaultsConfig(a,t);case 11:return void decodeUsageConfig(a,t);case 12:return void decodeHolidayConfig(a,t);case 13:return void decodeBootDelayConfig(a,t);case 14:return void decodeDefaultsConfig(a,t);case 19:return void decodeLocationConfig(a,t);case 21:return void decodeLedConfig(a,t);case 22:return void decodeMeteringAlertConfig(a,t,r);case 82:return void decodeMulticastConfig(a,t,r);case 255:return void decodeClearConfig(a,t,r);default:r.errors.push("invalid_header")}}function decodeDaliStatus(e,t){var r={},a=e.getUint8();r.dali_address_short=daliAddressParse(a,null,t);var i=e.getUint8Bits(),n=i.getBits(1);r.control_gear_failure=bitFalseTrue(n);var s=i.getBits(1);r.lamp_failure=bitFalseTrue(s),r.lamp_on=bitFalseTrue(i.getBits(1));var o=i.getBits(1);r.limit_error=bitFalseTrue(o),r.fade_running=bitFalseTrue(i.getBits(1)),r.reset_state=bitFalseTrue(i.getBits(1)),r.short_address=bitFalseTrue(i.getBits(1)),r.power_cycle_seen=bitFalseTrue(i.getBits(1));var u=[];return n&&u.push("control gear failure"),s&&u.push("lamp failure"),o&&u.push("limit error"),u.length&&t.errors.push("Dali address: "+r.dali_address_short.value+" errors: "+u.join(", ")),r}function decodeDaliStatusReq(e,t,r){if(t.packet_type={value:"dali_status_request"},1===e.availableLen()){var a=e.getUint8();t.dali_address_short=254===a?{value:"all_drivers",raw:a}:daliAddressParse(a,null,r)}else for(t.dali_statuses=[];e.availableLen();)t.dali_statuses.push(decodeDaliStatus(e,r))}function decodeDimming(e,t){var r={},a=e.getUint8();r.dali_address_short=daliAddressParse(a,null,t);var i=e.getUint8();return r.dimming_level={value:255===i?"resume":i,unit:"%",raw:i},r}function decodeDimmingCommand(e,t,r){for(t.packet_type={value:"manual_dimming_command"},t.manual_commands=[];e.availableLen();)t.manual_commands.push(decodeDimming(e,r))}function decodeCustomDaliReq(e,t,r){t.packet_type={value:"custom_dali_request"};var{offset:a}=e;if(t.custom_dali_data={value:bytesToHexStr(e.getRaw(e.availableLen()))},e.offset=a,!(e.availableLen()>3)){var i=e.getUint8();t.dali_address_short=daliAddressParse(i,null,r);var n=e.getUint8();if(t.dali_query={value:n},1===e.availableLen()){var s=e.getUint8();t.dali_answer={value:s}}}}function decodeCustomDaliCommand(e,t){t.packet_type={value:"custom_dali_command"};var r=e.getRaw(e.availableLen());t.dali_command={value:bytesToHexStr(r)}}function decodeStatusRequest(e,t){t.packet_type={value:"status_or_usage_request"};var r=e.getUint8Bits();t.usage_requested=bitFalseTrue(r.getBits(1)),t.status_requested=bitFalseTrue(r.getBits(1))}function decodeDigVal(e){return 0===e?"off":1===e?"on":255===e?"n/a":"invalid_value"}function decodeInterfacesRequest(e,t,r){if(1!==e.availableLen()){t.packet_type={value:"interface_request"};var a=e.getUint8(),i=e.getUint8(),n=e.getUint8(),s=e.getUint8(),o=e.getUint8();e.getUint8();var u=e.getUint8(),l=e.getUint8Bits();1===a&&2===n&&3===o&&4===u?(t.dig={value:decodeDigVal(i),raw:i},t.ldr={value:255===s?"n/a":s,raw:s},t.main_relay_state=bitFalseTrue(l.getBits(1)),t.open_drain_out_state=bitFalseTrue(l.getBits(1))):r.errors.push("invalid_interface")}else t.packet_type={value:"interface_request"}}function decodeDriverMemoryPartial(e,t,r){var a=e.getUint8();t.dali_address_short=daliAddressParse(a,null,r);var i=e.getUint8();t.memory_bank={value:i};var n=e.getUint8();t.memory_address={value:n}}function decodeDriverMemoryPartialSized(e,t,r){decodeDriverMemoryPartial(e,t,r);var a=e.getUint8();return t.read_size={value:a,unit:"bytes"},a}function decodeReadDriverMemory(e,t,r){if(t.packet_type={value:"driver_memory_read"},0!==e.availableLen()){var a=decodeDriverMemoryPartialSized(e,t,r);if(e.availableLen()){var i=e.getRaw(a);t.memory_value={value:bytesToHexStr(i)}}}else r.warnings.push("driver_memory_read_failed")}function decodeWriteDriverMemory(e,t,r){if(t.packet_type={value:"driver_memory_write"},0!==e.availableLen()){decodeDriverMemoryPartial(e,t);var a=e.getRaw(e.availableLen());t.memory_value={value:bytesToHexStr(a)}}else r.warnings.push("driver_memory_write_failed")}function decodeTimedDimming(e,t){var r={},a=e.getUint8();r.dali_address_short=daliAddressParse(a,null,t);var i=e.getUint8();r.dimming_level={value:i,unit:"%"};var n=e.getUint8();return r.duration={value:n,unit:"min"},r}function decodeTimedDimmingCommand(e,t,r){for(t.packet_type={value:"timed_dimming_command"},t.timed_commands=[];e.availableLen();)t.timed_commands.push(decodeTimedDimming(e,r))}function decodeOpenDrainSwitching(e,t){t.packet_type={value:"open_drain_out_control"};var r=e.getUint8Bits().getBits(1);t.open_drain_out_state=bitFalseTrue(r)}function decodeFport60(e,t,r){var a=new BinaryExtract(e);switch(a.getUint8()){case 0:return void decodeDaliStatusReq(a,t,r);case 1:return void decodeDimmingCommand(a,t,r);case 3:return void decodeCustomDaliReq(a,t,r);case 4:return void decodeCustomDaliCommand(a,t);case 5:return void decodeStatusRequest(a,t);case 6:return void decodeInterfacesRequest(a,t,r);case 7:return void decodeReadDriverMemory(a,t,r);case 8:return void decodeWriteDriverMemory(a,t,r);case 9:return void decodeTimedDimmingCommand(a,t,r);case 12:return void decodeOpenDrainSwitching(a,t);default:r.errors.push("invalid_command")}}function profileParser(e,t){var r={};profileParserPartial(e,r,t);var a=e.getUint8();return r.dimming_level={value:a,unit:"%",min:0,max:100},r}function statusParser(e,t,r){var a=new BinaryExtract(e);t.packet_type={value:"status_packet"};var i=a.getUint32();t.device_unix_epoch=decodeUnixEpoch(i);var n={},s=a.getUint8Bits(),o=s.getBits(1);n.dali_error_external=bitFalseTrue(o),o&&r.warnings.push("dali external error reported by status packet");var u=s.getBits(1);n.dali_error_connection=bitFalseTrue(u),u&&r.errors.push("dali connection error reported by status packet"),n.ldr_state=bitFalseTrue(s.getBits(1)),s.getBits(1),n.dig_state=bitFalseTrue(s.getBits(1)),n.hardware_error=bitFalseTrue(s.getBits(1)),n.firmware_error=bitFalseTrue(s.getBits(1)),n.internal_relay_state=bitFalseTrue(s.getBits(1)),t.status_field=n,t.downlink_rssi={value:-1*a.getUint8(),unit:"dBm"},t.downlink_snr={value:a.getInt8(),unit:"dB"},t.mcu_temperature={value:a.getInt8(),unit:"°C"};var l,d,c={},_=a.getUint8Bits();for(l=_.getBits(1),d=_.getBits(1),c.open_drain_out_state=bitFalseTrue(_.getBits(1)),_.getBits(1),c.voltage_alert_in_24h=bitFalseTrue(_.getBits(1)),c.lamp_error_alert_in_24h=bitFalseTrue(_.getBits(1)),c.power_alert_in_24h=bitFalseTrue(_.getBits(1)),c.power_factor_alert_in_24h=bitFalseTrue(_.getBits(1)),t.analog_interfaces=c,l&&(t.thr_value={value:a.getUint8()}),d&&(t.ldr_value={value:a.getUint8()}),t.profiles=[];a.availableLen();)t.profiles.push(profileParser(a,r))}function usageConsumptionParse(e,t){var r={},a=e.getUint8();r.dali_address_short=daliAddressParse(a,"internal_measurement",t);var i=e.getUint8Bits();return i.getBits(1)&&(r.active_energy_total={value:e.getUint32(),unit:"Wh"}),i.getBits(1)&&(r.active_energy_instant={value:e.getUint16(),unit:"W"}),i.getBits(1)&&(r.load_side_energy_total={value:e.getUint32(),unit:"Wh"}),i.getBits(1)&&(r.load_side_energy_instant={value:e.getUint16(),unit:"W"}),i.getBits(1)&&(r.power_factor_instant={value:e.getUint8()/100}),i.getBits(1)&&(r.mains_voltage={value:e.getUint8(),unit:"V"}),i.getBits(1)&&(r.driver_operating_time={value:e.getUint32(),unit:"s"}),i.getBits(1)&&(r.lamp_on_time={value:e.getUint32(),unit:255===a?"h":"s"}),r}function usageParser(e,t,r){var a=new BinaryExtract(e);for(t.packet_type={value:"usage_packet"},t.reports=[];a.availableLen();)t.reports.push(usageConsumptionParse(a,r))}function deviceConfigParser(e,t){switch(e){case 0:return"dali";case 1:return"dali_nc";case 2:return"dali_no";case 3:return"analog_nc";case 4:return"analog_no";case 5:return"dali_analog_nc";case 6:return"dali_analog_no";case 7:return"dali_analog_nc_no";default:return t.errors.push("invalid_device_config"),"invalid_config"}}function optionalFeaturesParser(e){var t=[],r=new BitExtract(e);return r.getBits(1),r.getBits(1)&&t.push("thr"),r.getBits(1)&&t.push("dig"),r.getBits(1)&&t.push("ldr"),r.getBits(1)&&t.push("open_drain_out"),r.getBits(1)&&t.push("metering"),r.getBits(1),r.getBits(1)&&t.push("custom_request"),t}function daliInfoParse(e,t){var r=e;if(r<112)return{value:r,raw:r,unit:"V"};switch(e){case 126:return{value:"bus_high",raw:r};case 127:return t.warnings.push("dali supply state: error"),{value:"dali_error",raw:r};default:return{value:"invalid_value",raw:r}}}function resetReasonParse(e){var t=[],r=new BitExtract(e);return r.getBits(1)&&t.push("reset_0"),r.getBits(1)&&t.push("watchdog_reset"),r.getBits(1)&&t.push("soft_reset"),r.getBits(1)&&t.push("reset_3"),r.getBits(1)&&t.push("reset_4"),r.getBits(1)&&t.push("reset_5"),r.getBits(1)&&t.push("reset_6"),r.getBits(1)&&t.push("reset_7"),t}function bootParser(e,t,r){t.packet_type={value:"boot_packet"},t.device_serial=intToHexStr(e.getUint32(),8);var a=e.getUint8(),i=e.getUint8(),n=e.getUint8();t.firmware_version={value:a+"."+i+"."+n,raw:a<<16|i<<8|n};var s=e.getUint32();t.device_unix_epoch=decodeUnixEpoch(s);var o=e.getUint8();t.device_config={value:deviceConfigParser(o,r),raw:o};var u=e.getUint8();t.optional_features={value:optionalFeaturesParser(u),raw:u};var l=e.getUint8Bits();t.dali_supply_state=daliInfoParse(l.getBits(7),r);var d=l.getBits(1);t.dali_power_source={value:d?"external":"internal",raw:d};var c=e.getUint8Bits();t.dali_addressed_driver_count={value:c.getBits(7)};var _=c.getBits(1);if(t.dali_unadressed_driver_found=bitFalseTrue(_),e.availableLen()){var g=e.getUint8();t.reset_reason={value:resetReasonParse(g),raw:g}}}function errorCodeParser(e){switch(e){case 0:case 1:return"n/a";case 2:return"unknown_fport";case 3:return"packet_size_short";case 4:return"packet_size_long";case 5:return"value_error";case 6:return"protocol_parse_error";case 7:return"reserved_flag_set";case 8:return"invalid_flag_combination";case 9:return"unavailable_feature_request";case 10:return"unsupported_header";case 11:return"unreachable_hw_request";case 12:return"address_not_available";case 13:return"internal_error";case 14:return"packet_size_error";case 128:return"no_room";case 129:return"id_seq_error";case 130:return"destination_eror";case 131:return"days_error";case 132:return"step_count_error";case 133:return"step_value_error";case 134:return"step_unsorted";case 135:return"days_overlap";default:return"invalid_error_code"}}function configFailedParser(e,t,r){t.packet_type={value:"invalid_downlink_packet"},t.packet_from_fport={value:e.getUint8()};var a=e.getUint8(),i=errorCodeParser(a);t.parse_error_code={value:i,raw:a},r.errors.push("Config failed: "+i)}function decodeFport99(e,t,r){var a=new BinaryExtract(e);switch(a.getUint8()){case 0:return void bootParser(a,t,r);case 19:return void configFailedParser(a,t,r);default:r.errors.push("invalid_header")}}function decodeFport61(e,t,r){var a=new BinaryExtract(e),i=a.getUint8(),n=a.getUint8(),s=n>>4;switch(i){case 128:if(t.packet_type={value:"dig_alert"},2!==s)return void r.errors.push("invalid_packet_length");var o=a.getUint16();return void(t.dig_alert_counter={value:o});case 129:if(t.packet_type={value:"ldr_alert"},2!==s)return void r.errors.push("invalid_packet_length");var u=a.getUint8Bits().getBits(1),l=a.getUint8();return t.ldr_state=bitFalseTrue(u),void(t.ldr_value={value:l});case 131:for(t.packet_type={value:"dali_driver_alert"},t.drivers=[];a.availableLen();)t.drivers.push(decodeDaliStatus(a,r));return;case 132:t.packet_type={value:"metering_alert"};var d=new BitExtract(n),c=d.getBits(1),_=d.getBits(1),g=d.getBits(1),v=d.getBits(1),f=d.getBits(1);t.lamp_error_alert=bitFalseTrue(c),t.over_current_alert=bitFalseTrue(_),t.under_voltage_alert=bitFalseTrue(g),t.over_voltage_alert=bitFalseTrue(v),t.low_power_factor_alert=bitFalseTrue(f);var p=[];c&&p.push("lamp_error"),_&&p.push("over_current"),g&&p.push("under_voltage"),v&&p.push("over_voltage"),f&&p.push("low_power_factor"),p.length&&r.warnings.push("Metering alerts: "+p.join(", "));var h=a.getUint16();t.power={value:h,unit:"W"};var m=a.getUint16();t.voltage={value:m,unit:"V"};var y=a.getUint8()/100;return void(t.power_factor={value:y});default:r.errors.push("invalid_header")}}function decodeFport49(e,t,r){var a=new BinaryExtract(e);switch(a.getUint8()){case 1:return void(t.packet_type={value:"ldr_config_request"});case 2:return void(t.packet_type={value:"thr_config_request"});case 3:return void(t.packet_type={value:"dig_config_request"});case 5:return void(t.packet_type={value:"open_drain_out_config_request"});case 6:return void(t.packet_type={value:"calendar_config_request"});case 7:return void(t.packet_type={value:"status_config_request"});case 8:t.packet_type={value:"profile_config_request"};var i=a.getUint8();return void(t.profile_id={value:255===i?"all_used_profiles":i,raw:i});case 10:return void(t.packet_type={value:"default_dim_config_request"});case 11:return void(t.packet_type={value:"usage_config_request"});case 12:return void(t.packet_type={value:"holiday_config_request"});case 13:return void(t.packet_type={value:"boot_delay_config_request"});case 14:return void(t.packet_type={value:"defaults_config_request"});case 19:return void(t.packet_type={value:"meta_pos_config_request"});case 21:return void(t.packet_type={value:"led_config_request"});case 22:return void(t.packet_type={value:"metering_alert_confic_request"});case 82:return t.packet_type={value:"multicast_config_request"},void(t.multicast_device={value:a.getUint8()});default:r.errors.push("invalid_header")}}function decodeFport51(e,t,r){255!==new BinaryExtract(e).getUint8()?r.errors.push("invalid_command"):t.packet_type={value:"activate_dfu_command"}}function decodeByFport(e,t,r,a){0===t.length?a.errors.push("empty_payload"):24===e?statusParser(t,r,a):25===e?usageParser(t,r,a):49===e?decodeFport49(t,r,a):50===e?decodeFport50(t,r,a):51===e?decodeFport51(t,r,a):60===e?decodeFport60(t,r,a):61===e?decodeFport61(t,r,a):99===e?decodeFport99(t,r,a):a.errors.push("invalid_fport")}function decodeRaw(e,t){var r={},a={errors:[],warnings:[]};try{decodeByFport(e,t,r,a)}catch(e){a.errors.push(e.message)}return{data:r,errors:a.errors,warnings:a.warnings}}function formatElementStrValueUnit(e,t){var r=e.toString();t.length>0&&(isNaN(+r)||(r=r+" "+t));return r}function convertObjRecursive(e,t){if(e.constructor===Object){if("value"in e){var r=e.value,a="unit"in e?e.unit:"";return t(r,a)}var i={};for(var n in e)void 0!==e[n]&&e[n]&&(i[n]=convertObjRecursive(e[n],t));return i}if(e instanceof Array){var s=[];return e.forEach((e=>{s.push(convertObjRecursive(e,t))})),s}return e}function convertObjToFormatted(e,t){var r={};for(var a in e)void 0!==e[a]&&e[a]&&(r[a]=convertObjRecursive(e[a],t));return r}function decodeDownlink(e){return convertObjToFormatted(decodeRaw(e.fPort,e.bytes),formatElementStrValueUnit)}function decodeUplink(e){return convertObjToFormatted(decodeRaw(e.fPort,e.bytes),formatElementStrValueUnit)}function Decoder(e,t){return convertObjToFormatted(decodeRaw(t,e),formatElementStrValueUnit)}function Decode(e,t){return convertObjToFormatted(decodeRaw(e,t),formatElementStrValueUnit)}BitExtract.prototype._assertOnRemainingLength=function(e){if(0===e)throw Error("invalid zero length bit field");if(this.offset+e>8)throw Error("invalid number of bits extracted")},BitExtract.prototype.getBits=function(e){this._assertOnRemainingLength(e);var t=2**e-1,r=this.data>>this.offset&t;return this.offset+=e,1===e?Boolean(r):r},BinaryExtract.prototype.availableLen=function(){return this.buffer.length-this.offset},BinaryExtract.prototype._assertOnRemainingLength=function(e){if(e>this.availableLen())throw Error("invalid buffer length: too short")},BinaryExtract.prototype.getUint8=function(){return this._assertOnRemainingLength(1),this.buffer[this.offset++]},BinaryExtract.prototype.getInt8=function(){var e=this.getUint8();return e>127?e-256:e},BinaryExtract.prototype.getUint16=function(){return this._assertOnRemainingLength(2),this.buffer[this.offset++]+256*this.buffer[this.offset++]},BinaryExtract.prototype.getInt16=function(){var e=this.getUint16();return e>32767?e-65536:e},BinaryExtract.prototype.getUint24=function(){return this._assertOnRemainingLength(3),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]},BinaryExtract.prototype.getUint32=function(){return this._assertOnRemainingLength(4),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]+16777216*this.buffer[this.offset++]},BinaryExtract.prototype.getInt32=function(){var e=this.getUint32();return e>2147483647?e-4294967296:e},BinaryExtract.prototype.getUint64=function(){return this.getUint32()+4294967296*this.getUint32()},BinaryExtract.prototype.getTextUtf8=function(e){this._assertOnRemainingLength(e);var t=stringFromUTF8Array(this.buffer.slice(this.offset,this.offset+e));return this.offset+=e,t},BinaryExtract.prototype.getUint8Bits=function(){return new BitExtract(this.getUint8())},BinaryExtract.prototype.getRaw=function(e){this._assertOnRemainingLength(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},BinaryExtract.prototype.getFloat=function(){var e=this.getUint32(),t=2147483648&e?-1:1,r=(e>>23&255)-127,a=8388607&e;if(128===r)return t*(a?Number.NaN:Number.POSITIVE_INFINITY);if(-127===r){if(0===a)return 0*t;r=-126,a/=1<<22}else a=(a|1<<23)/(1<<23);return t*a*2**r};
