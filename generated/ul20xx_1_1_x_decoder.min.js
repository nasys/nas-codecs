function stringFromUTF8Array(e){for(var t=[1,1,1,1,2,2,3,0],r=e.length,i="",n=0;n<r;){var a=e[n++];if(128&a){var s=t[a>>3&7];if(!(64&a)||!s||n+s>r)return null;for(a&=63>>s;s>0;s-=1){var o=e[n++];if(128!=(192&o))return null;a=a<<6|63&o}}i+=String.fromCharCode(a)}return i}function BitExtract(e){this.data=e,this.offset=0}function BinaryExtract(e){this.buffer=e,this.offset=0}function pad(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}function intToHexStr(e,t){return pad(e.toString(16).toUpperCase(),t)}function bytesToHexStr(e){for(var t="",r=0;r<e.length;r+=1)t+=("00"+e[r].toString(16)).slice(-2).toUpperCase();return t}function profileReason(e,t){switch(e){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:return"profile_"+e;case 33:return"calendar_day";case 34:return"calendar_night";case 48:return"calendar_dawn_step";case 80:return"calendar_dusk_step";case 245:return"relay_off";case 248:return"fallback_active";case 246:return"driver_not_found";case 250:return"ldr_input_active";case 252:return"dig_input_active";case 253:return"manual_active";case 255:return"unknown";default:return t.errors.push("invalid_reason"),"invalid_reason"}}function addressParse(e,t,r){return 1===e?"analog_0_10v":254===e?"dali_broadcast":255===e?t||(r.warnings.push("invalid_address"),"invalid"):1&e?(r.warnings.push("invalid_address"),"invalid"):128&e?"dali_group_"+(e>>1&15).toString():"dali_single_"+(e>>1&63).toString()}function profileParserPartial(e,t,r){var i=e.getUint8();t.profile_id=255===i?"no_profile":i;var n;n=e.getUint8();var a=e.getUint8();t.address=addressParse(a,"all_devices",r);var s=new BitExtract(e.getUint8()),o=[];return s.getBits(1)&&o.push("holiday"),s.getBits(1)&&o.push("mon"),s.getBits(1)&&o.push("tue"),s.getBits(1)&&o.push("wed"),s.getBits(1)&&o.push("thu"),s.getBits(1)&&o.push("fri"),s.getBits(1)&&o.push("sat"),s.getBits(1)&&o.push("sun"),t.days_active=o,e.getUint8(),n}function decodeUnixEpoch(e,t){var r=new Date(1e3*e).toISOString();return e<1420070400&&(r="invalid_timestamp",t.warnings.push("invalid_timestamp")),r}function decodeLdrConfig(e,t){t.packet_type="ldr_input_config_packet";var r=e.getUint8();t.ldr_off_threshold_high=255===r?"disabled":r;var i=e.getUint8();t.ldr_on_threshold_low=255===i?"disabled":i;var n=e.getUint8Bits();n.getBits(2),t.trigger_alert_enabled=n.getBits(1)}function decodeLightDimStep(e){var t={},r=e.getFloat(),i=e.getUint8();return t.light_level__lx=formatLightLx(r),t.dimming_level__percent=decodeDimmingLevel(i,"inactive"),t}function decodeLightSensorConfig(e,t,r){if(t.packet_type="light_sensor_config_packet",255!==e.getUint8()){var i=e.getUint8Bits();for(t.alert_on_every_step=i.getBits(1),t.clamp_profile=i.getBits(1),t.clamp_dig=i.getBits(1),t.interpolate_steps=i.getBits(1),t.measurement_duration__s=e.getUint8(),t.address=addressParse(e.getUint8(),"all_devices",r),t.dim_steps=[];e.availableLen();)t.dim_steps.push(decodeLightDimStep(e))}}function decodeDimmingLevel(e,t){return 255===e?t:e}function decodeDigConfig(e,t,r){t.packet_type="dig_input_config_packet";var i=e.getUint16();t.light_on_duration__s=65535===i?"dig_input_disabled":i;var n=e.getUint8Bits();n.getBits(1),t.signal_edge_rising=n.getBits(1),t.trigger_alert_enabled=n.getBits(1),t.address=addressParse(e.getUint8(),"all_devices",r),t.dimming_level__percent=decodeDimmingLevel(e.getUint8(),"disabled")}function decodeDigInputConfigNew(e,t,r){if(t.packet_type="dig_input_config_packet",255!==e.getUint8()){var i=e.getUint8Bits();t.dig_mode_button=i.getBits(1),t.polarity_high_or_rising=i.getBits(1),t.alert_on_activation=i.getBits(1),t.alert_on_inactivation=i.getBits(1),t.address=addressParse(e.getUint8(),"all_devices",r),t.active_dimming_level__percent=decodeDimmingLevel(e.getUint8(),"inactive"),t.inactive_dimming_level__percent=decodeDimmingLevel(e.getUint8(),"inactive");var n=e.getUint16(),a=e.getUint16();t.on_delay__s=n,t.off_delay__s=a}}function decodeStepTime(e){var t=10*e,r=Math.trunc(t/60),i=t-60*r;return pad(r,2)+":"+pad(i,2)}function decodeOdRelaySwStep(e){var t={};t.step_time=decodeStepTime(e.getUint8());var r=0!==e.getUint8();return t.open_drain_output_on=r,t}function decodeZenithStep(e){var t={};t.zenith_angle__deg=(e.getInt8()/6+90).toFixed(2);var r=e.getUint8();return t.dimming_level__percent=decodeDimmingLevel(r,"disabled"),t}function decodeCalendarConfigV11(e,t){t.packet_type="calendar_config_packet";var r=e.getUint8Bits(),i=r.getBits(4),n=r.getBits(4),a=e.getUint8Bits();t.calendar_prefers_meta_pos=a.getBits(1),t.calendar_clamps_profiles=a.getBits(1),t.calendar_clamps_dig=a.getBits(1),t.latitude__deg=e.getInt16()/100,t.longitude__deg=e.getInt16()/100,t.sunrise_steps=[],t.sunset_steps=[];for(var s=0;s<i;s+=1)t.sunrise_steps.push(decodeZenithStep(e));for(var o=0;o<n;o+=1)t.sunset_steps.push(decodeZenithStep(e))}function decodeStatusConfig(e,t){t.packet_type="status_config_packet",t.status_interval__s=e.getUint32()}function decodeDimmingStep(e){var t={};return t.step_time=decodeStepTime(e.getUint8()),t.dimming_level__percent=decodeDimmingLevel(e.getUint8(),"inactive"),t}function decodeProfileConfig(e,t,r){t.packet_type="profile_config_packet";var i=profileParserPartial(e,t,r);t.dimming_steps=[];for(var n=0;n<i;n+=1)t.dimming_steps.push(decodeDimmingStep(e))}function decodeTimeConfig(e,t,r){t.packet_type="time_config_packet";var i=e.getUint32();t.device_unix_epoch=0==i?"force_lorawan_devicetimereq":decodeUnixEpoch(i,r)}function decodeUsageConfig(e,t){t.packet_type="usage_config_packet";var r=e.getUint32(),i=e.getUint8();t.usage_interval__s=r,255!==i&&(t.mains_voltage__V=i)}function decodeMonthDay(e){return pad(e.getUint8(),2)+"/"+pad(e.getUint8(),2)}function decodeHolidayConfig(e,t){t.packet_type="holiday_config_packet",t.holidays=[];for(var r=e.getUint8(),i=0;i<r;i+=1)t.holidays.push(decodeMonthDay(e))}function decodeDaliMonitorConfig(e,t){var r=e.getUint8Bits();t.packet_type="dali_monitor_config_packet",t.send_dali_alert=r.getBits(1),t.correct_dali_dimming_level=r.getBits(1),t.periodic_bus_scan_enabled=r.getBits(1);var i=e.getUint16();t.monitoring_interval__s=i,0===i&&(t.monitoring_interval="disabled")}function decodeFallbackDimConfig(e,t){t.packet_type="fallback_dim_config_packet",t.fallback_dimming_level__percent=e.getUint8()}function decodeMulticastFcntConfig(e,t){t.packet_type="multicast_fcnt_config_packet",t.multicast_device=e.getUint8(),t.multicast_fcnt=e.getUint32()}function decodeBootDelayConfig(e,t){t.packet_type="boot_delay_config_packet";var r=1===e.availableLen()?e.getUint8():e.getUint16();t.boot_delay_range__s=r}function decodeFade(e,t){return 255===e?"ignore":e>=16?(t.errors.push("invalid_fade"),"invalid_fade"):[.5,.71,1,1.41,2,2.83,4,5.66,8,11.31,16,22.63,32,45.25,64,90.51][e]}function decodeLocationConfigV11(e,t){t.packet_type="location_config_packet";var r=e.getUint8();t.latitude__deg=e.getInt32()/1e7,t.longitude__deg=e.getInt32()/1e7,t.address=e.getTextUtf8(r)}function decodeLumalinkMode(e,t){switch(e){case 0:return"never_advertise";case 1:return"first_commission";case 2:return"every_boot";case 3:return"always";default:return t.errors.push("invalid_mode"),"invalid_mode"}}function decodeLumalinkConfig(e,t,r){t.packet_type="lumalink_config_packet",t.access_mode=decodeLumalinkMode(e.getUint8(),r)}function decodeLedConfig(e,t){t.packet_type="onboard_led_config_packet";var r=e.getUint8Bits().getBits(1);t.status_led_enabled=r}function alertParamConfig(e,t){return e===t?"alert_off":e}function decodeMeteringAlertConfig(e,t,r){if(t.packet_type="metering_alert_config_packet",1===e.getUint8()){var i=e.getUint16(),n=e.getUint16(),a=e.getUint16(),s=e.getUint16(),o=e.getUint8();t.min_power__W=alertParamConfig(i,65535),t.max_power__W=alertParamConfig(n,65535),t.min_voltage__V=alertParamConfig(a,65535),t.max_voltage__V=alertParamConfig(s,65535),t.min_power_factor=255===o?"alert_off":o/100}else r.errors.push("invalid_header")}function decodeFadeConfig(e,t,r){t.packet_type="fade_config_packet",t.fade_duration__s=decodeFade(e.getUint8(),r)}function decodeMulticastConfig(e,t,r){t.packet_type="multicast_config_packet";var i=e.getUint8();i>3?r.errors.push("invalid_multicast_device"):(t.multicast_device=i,t.devaddr=bytesToHexStr(e.getRaw(4).reverse()),t.nwkskey=bytesToHexStr(e.getRaw(16)),t.appskey=bytesToHexStr(e.getRaw(16)))}function decodeClearConfig(e,t,r){switch(t.packet_type="clear_config_packet",e.getUint8()){case 1:t.reset_target="ldr_input_config";break;case 3:t.reset_target="dig_input_config";break;case 33:t.reset_target="profile_config",t.address=addressParse(e.getUint8(),"all_profiles",r);break;case 35:t.reset_target="holiday_config";break;case 82:t.reset_target="multicast_config";var i=e.getUint8();t.multicast_device=255===i?"all_multicast_devices":"multicast_device_"+i;break;case 255:t.reset_target="factory_reset",t.device_serial=intToHexStr(e.getUint32(),8);break;default:r.errors.push("invalid_clear_config_target")}}function decodeFport50(e,t,r){switch(e.getUint8()){case 1:return void decodeLdrConfig(e,t);case 3:return void decodeDigConfig(e,t,r);case 5:for(t.packet_type="open_drain_output_config_packet",t.switching_steps=[];e.availableLen();)t.switching_steps.push(decodeOdRelaySwStep(e));return;case 7:return void decodeStatusConfig(e,t);case 9:return void decodeTimeConfig(e,t,r);case 11:return void decodeUsageConfig(e,t);case 13:return void decodeBootDelayConfig(e,t);case 21:return void decodeLedConfig(e,t);case 22:return void decodeMeteringAlertConfig(e,t,r);case 82:return void decodeMulticastConfig(e,t,r);case 255:return void decodeClearConfig(e,t,r);case 32:return void decodeCalendarConfigV11(e,t);case 33:return void decodeProfileConfig(e,t,r);case 34:return void decodeFadeConfig(e,t,r);case 35:return void decodeHolidayConfig(e,t);case 36:return void decodeDaliMonitorConfig(e,t);case 37:return void decodeFallbackDimConfig(e,t);case 38:return void decodeLocationConfigV11(e,t);case 39:return void decodeLumalinkConfig(e,t,r);case 40:return void decodeDigInputConfigNew(e,t,r);case 41:return void decodeLightSensorConfig(e,t,r);case 83:return void decodeMulticastFcntConfig(e,t);case 254:for(t.packet_type={value:"chained_config_packet"},t.payloads=[];e.availableLen();){var i={};decodeFport50(e,i,r),t.payloads.push(i)}return;default:r.errors.push("invalid_header")}}function daliStatus(e,t,r){var i={driver_error:!1,lamp_failure:!1,lamp_on:!1,limit_error:!1,fade_running:!1,reset_state:!1,missing_short_address:!1,power_failure:!1};if(255===e.data)return i;var n=e.getBits(1);i.driver_error=n;var a=e.getBits(1);i.lamp_failure=a,i.lamp_on=e.getBits(1);var s=e.getBits(1);i.limit_error=s,i.fade_running=e.getBits(1);var o=e.getBits(1);i.reset_state=o;var d=e.getBits(1);i.missing_short_address=d;var _=e.getBits(1);return i.power_failure=_,n&&r.warnings.push(t+" driver_error"),a&&r.warnings.push(t+" lamp_failure"),s&&r.warnings.push(t+" limit_error"),o&&r.warnings.push(t+" reset_state"),_&&r.warnings.push(t+" power_failure"),i}function decodeDaliStatus(e,t){var r={},i=addressParse(e.getUint8(),null,t);return r.address=i,r.status=daliStatus(e.getUint8Bits(),i,t),r}function decodeDimming(e,t){var r={};return r.address=addressParse(e.getUint8(),"all_devices",t),r.dimming_level__percent=decodeDimmingLevel(e.getUint8(),"resume"),r}function decodeDimmingCommand(e,t,r){for(t.packet_type="manual_dimming",t.destination=[];e.availableLen();)t.destination.push(decodeDimming(e,r))}function decodeCustomDaliReq(e,t,r){t.packet_type="custom_dali_request";var i=e.offset;if(t.query_data_raw=bytesToHexStr(e.getRaw(e.availableLen())),e.offset=i,e.availableLen()>3)e.getRaw(e.availableLen());else{var n=e.getUint8();t.address=addressParse(n,null,r),t.dali_query=e.getUint8(),1===e.availableLen()&&(t.dali_response=e.getUint8())}}function decodeCustomDaliCommand(e,t){t.packet_type="custom_dali_command",t.dali_command=bytesToHexStr(e.getRaw(e.availableLen()))}function decodeDimMap(e,t){var r={};return r.address=addressParse(e.getUint8(),null,t),r.dali_min_level=e.getUint8(),r.dali_max_level=e.getUint8(),r.dimming_curve=0===e.getUint8()?"logarithmic":"linear",r}function decodeStatusRequest(e,t,r){t.packet_type="status_usage_request";var i=e.getUint8Bits();if(t.usage_requested=i.getBits(1),t.status_requested=i.getBits(1),t.dim_map_report_requested=i.getBits(1),t.dim_map_report_requested&&e.availableLen()>0)for(t.drivers=[];e.availableLen();)t.drivers.push(decodeDimMap(e,r))}function decodeDriverMemoryPartial(e,t,r){t.address=addressParse(e.getUint8(),null,r),t.memory_bank=e.getUint8(),t.memory_address=e.getUint8()}function decodeDriverMemoryPartialSized(e,t,r){decodeDriverMemoryPartial(e,t,r);var i=e.getUint8();return t.read_size__bytes=i,i}function decodeReadDriverMemory(e,t,r){if(t.packet_type="driver_memory_read",0!==e.availableLen()){var i=decodeDriverMemoryPartialSized(e,t,r);if(e.availableLen()){var n=e.getRaw(i);t.memory_value=bytesToHexStr(n)}}else r.warnings.push("driver_memory_read_failed")}function decodeWriteDriverMemory(e,t,r){t.packet_type="driver_memory_write",0!==e.availableLen()?(decodeDriverMemoryPartial(e,t),t.memory_value=bytesToHexStr(e.getRaw(e.availableLen()))):r.warnings.push("driver_memory_write_failed")}function decodeTimedDimming(e,t){var r={};return r.address=addressParse(e.getUint8(),"all_devices",t),r.dimming_level__percent=decodeDimmingLevel(e.getUint8(),"resume"),r.duration__min=e.getUint8(),r}function decodeTimedDimmingCommand(e,t,r){for(t.packet_type="manual_timed_dimming",t.destination=[];e.availableLen();)t.destination.push(decodeTimedDimming(e,r))}function decodeAddressDaliDriver(e,t,r){t.packet_type={value:"address_dali_driver"},t.address=addressParse(e.getUint8(),"rescan_dali_bus",r)}function decodeDaliIdentify(e){e.packet_type="dali_identify"}function decodeOpenDrainSwitching(e,t){t.packet_type="open_drain_output_control",t.open_drain_output_on=e.getUint8Bits().getBits(1)}function decodeFport60(e,t,r){switch(e.getUint8()){case 1:return void decodeDimmingCommand(e,t,r);case 3:return void decodeCustomDaliReq(e,t,r);case 4:return void decodeCustomDaliCommand(e,t);case 5:return void decodeStatusRequest(e,t,r);case 7:return void decodeReadDriverMemory(e,t,r);case 8:return void decodeWriteDriverMemory(e,t,r);case 9:return void decodeTimedDimmingCommand(e,t,r);case 12:return void decodeOpenDrainSwitching(e,t);case 10:return void decodeAddressDaliDriver(e,t,r);case 11:return void decodeDaliIdentify(t);default:r.errors.push("invalid_command")}}function dimmingSourceParser(e,t){var r={};return r.address=addressParse(e.getUint8(),null,t),r.reason=profileReason(e.getUint8(),t),r.dimming_level__percent=decodeDimmingLevel(e.getUint8(),"ignore"),r.status=daliStatus(e.getUint8Bits(),r.address,t),r}function formatLightLx(e){var t=Math.log10(e),r=t>=0?t:0,i=r>3?3:r,n=3-Math.trunc(i);return e.toFixed(n)}function calcLightLx(e){var t=32767&e;return formatLightLx(Math.pow(10,t/4e3)/1e3)}function decodeSensorSource(e,t,r,i){if(1===t)return r.sensor_source.ldr_input=e.getUint8(),1;if(2==t)return r.sensor_source.light_sensor__lx=calcLightLx(e.getUint16()),2;if(3==t)return r.sensor_source.d4i_light_sensor__lx=calcLightLx(e.getUint16()),2;if(4==t){var n=e.getUint8Bits();return r.sensor_source.dig_input_1_on=n.getBits(1),1}if(8==t){var a=e.getUint8();return 255==a&&(a=null),r.sensor_source.tilt_sensor__deg=a,1}return 0}function statusParser1_1(e,t,r){t.packet_type="status_packet";var i=0===(C=e.getUint8());if(i||1===C){var n=e.getUint32();t.device_unix_epoch=decodeUnixEpoch(n,r);var a={},s=e.getUint8Bits();s.getBits(1);var o=s.getBits(1),d=s.getBits(1);s.getBits(1);var _=s.getBits(1),c=s.getBits(1),g=s.getBits(1),u=s.getBits(1);if(a.dali_connection_error=o,o&&r.warnings.push("dali_connection_error"),a.metering_com_error=c,c&&r.warnings.push("metering_com_error"),a.ext_rtc_warning=g,g&&r.warnings.push("ext_rtc_warning"),a.internal_relay_closed=u,i&&(a.ldr_input_on=d,a.dig_input_on=_),!i){var l=e.getUint8Bits();l.getBits(1),l.getBits(1),a.open_drain_output_on=l.getBits(1),l.getBits(1),l.getBits(1),l.getBits(1),a.lumalink_connected=l.getBits(1),a.lumalink_connected_once=l.getBits(1)}t.status=a,t.downlink_rssi__dBm=-1*e.getUint8(),t.downlink_snr__dB=e.getInt8(),t.mcu_temperature__C=e.getInt8();var p=!0;if(i){var f=e.getUint8Bits();f.getBits(1);var v=f.getBits(1),m=f.getBits(1);f.getBits(1),t.status.open_drain_output_on=m,p=f.getBits(1),v&&(t.ldr_input_value=e.getUint8())}if(p){var h=e.getUint8Bits();h.getBits(4);var y=h.getBits(1),U=h.getBits(1),B=h.getBits(1),k=h.getBits(1),w={};w.voltage_alert_in_24h=y,w.lamp_error_alert_in_24h=U,w.power_alert_in_24h=B,w.power_factor_alert_in_24h=k,t.active_alerts=w,y&&r.warnings.push("voltage_alert_in_24h"),U&&r.warnings.push("lamp_error_alert_in_24h"),B&&r.warnings.push("power_alert_in_24h"),k&&r.warnings.push("power_factor_alert_in_24h")}if(!i){var b=e.getUint8();for(t.sensor_source={};b>0;){var C=e.getUint8();b-=1;var L=decodeSensorSource(e,C,t);0==L?(r.errors.push("unsupported_sensor_source"),e.getRaw(b),b=0):b-=L}b<0&&r.errors.push("error_decoding_sensor_source")}for(t.dimming_source=[];e.availableLen();)t.dimming_source.push(dimmingSourceParser(e,r))}else r.errors.push("invalid_header")}function usageConsumptionParse(e,t){var r={},i=e.getUint8();r.address=addressParse(i,"internal_measurement",t);var n=e.getUint8Bits();if(n.getBits(1)&&(r.active_energy__Wh=e.getUint32()),n.getBits(1)&&(r.active_power__W=e.getUint16()),n.getBits(1)&&(r.load_side_energy__Wh=e.getUint32()),n.getBits(1)&&(r.load_side_power__W=e.getUint16()),n.getBits(1)){var a=e.getUint8();r.power_factor=255===a?"unknown":a/100}return n.getBits(1)&&(r.mains_voltage__V=e.getUint8()),n.getBits(1)&&(r.driver_operating_time__s=e.getUint32()),n.getBits(1)&&(r.lamp_on_time__s=e.getUint32()),r}function usageParser(e,t,r){if(0===e.getUint8())for(t.packet_type="usage_packet",t.consumption=[];e.availableLen();)t.consumption.push(usageConsumptionParse(e,r));else r.errors.push("invalid_header")}function deviceConfigParser(e,t){switch(e){case 0:return"dali";case 1:return"dali_nc";case 2:return"dali_no";case 3:return"analog_nc";case 4:return"analog_no";case 5:return"dali_analog_nc";case 6:return"dali_analog_no";case 7:return"dali_analog_nc_no";default:return t.errors.push("invalid_device_config"),"invalid_config"}}function optionalFeaturesParser(e){var t={},r=new BitExtract(e);return r.getBits(1),r.getBits(1),t.dig_input=r.getBits(1),t.ldr_input=r.getBits(1),t.open_drain_output=r.getBits(1),t.metering=r.getBits(1),r.getBits(1),r.getBits(1),t}function daliSupplyParse(e,t){if(e<112)return e;switch(e){case 126:return"bus_high";case 127:return t.warnings.push("dali_bus_error"),"bus_error";default:return"invalid_value"}}function resetReasonParse(e,t){var r=[],i=new BitExtract(e);return i.getBits(1)&&r.push("reset_0"),i.getBits(1)&&(r.push("watchdog_reset"),t.warnings.push("watchdog_reset")),i.getBits(1)&&r.push("soft_reset"),i.getBits(1)&&r.push("reset_3"),i.getBits(1)&&r.push("reset_4"),i.getBits(1)&&r.push("reset_5"),i.getBits(1)&&r.push("reset_6"),i.getBits(1)&&r.push("reset_7"),r}function bootParser(e,t,r){t.packet_type="boot_packet",t.device_serial=intToHexStr(e.getUint32(),8),t.firmware_version=e.getUint8()+"."+e.getUint8()+"."+e.getUint8(),t.device_unix_epoch=decodeUnixEpoch(e.getUint32(),r),t.device_config=deviceConfigParser(e.getUint8(),r),t.optional_features=optionalFeaturesParser(e.getUint8());var i=e.getUint8Bits();t.dali_supply_state__V=daliSupplyParse(i.getBits(7),r),t.dali_power_source_external=i.getBits(1)?"external":"internal";var n=e.getUint8Bits();t.dali_addressed_driver_count=n.getBits(7);var a=n.getBits(1);t.dali_unadressed_driver_found=a,a&&r.warnings.push("unadressed_dali_driver_on_bus"),e.availableLen()&&(t.reset_reason=resetReasonParse(e.getUint8(),r))}function errorCodeParser(e){switch(e){case 0:case 1:return"n/a";case 2:return"unknown_fport";case 3:return"packet_size_short";case 4:return"packet_size_long";case 5:return"value_error";case 6:return"protocol_parse_error";case 7:return"reserved_flag_set";case 8:return"invalid_flag_combination";case 9:return"unavailable_feature_request";case 10:return"unsupported_header";case 11:return"unreachable_hw_request";case 12:return"address_not_available";case 13:return"internal_error";case 14:return"packet_size_error";case 129:return"profile_id_seq_error";case 130:return"profile_destination_eror";case 131:return"profile_days_error";case 132:return"profile_step_count_error";case 133:return"profile_step_value_error";case 134:return"profile_step_unsorted_error";default:return"invalid_error_code"}}function configFailedParser(e,t,r){t.packet_type="invalid_downlink_packet",t.downlink_from_fport=e.getUint8();var i=errorCodeParser(e.getUint8());t.error_reason=i,r.warnings.push("downlink_"+i)}function decodeFport99(e,t,r){switch(e.getUint8()){case 0:return void bootParser(e,t,r);case 19:return void configFailedParser(e,t,r);default:r.errors.push("invalid_header")}}function decodeFport61(e,t,r){var i=e.getUint8(),n=e.getUint8(),a=n>>4;switch(i){case 128:if(t.packet_type="dig_input_alert",r.warnings.push("dig_input_alert"),2===a)t.dig_input_event_counter=e.getUint16();else if(4===a){var s=new BitExtract(n);t.dig_input_on=s.getBits(1),t.dig_input_event_counter=e.getUint32()}else r.errors.push("invalid_packet_length");return;case 129:if(t.packet_type="ldr_input_alert",2!==a)return void r.errors.push("invalid_packet_length");r.warnings.push("ldr_input_alert");var o=e.getUint8Bits().getBits(1),d=e.getUint8();return t.ldr_input_on=o,void(t.ldr_input_value=d);case 131:for(t.packet_type="dali_driver_alert",t.drivers=[];e.availableLen();)t.drivers.push(decodeDaliStatus(e,r));return;case 132:t.packet_type="metering_alert";var _=new BitExtract(n),c=_.getBits(1),g=_.getBits(1),u=_.getBits(1),l=_.getBits(1),p=_.getBits(1);return t.lamp_error_alert=c,t.over_current_alert=g,t.under_voltage_alert=u,t.over_voltage_alert=l,t.low_power_factor_alert=p,c&&r.warnings.push("metering_lamp_error"),g&&r.warnings.push("metering_over_current"),u&&r.warnings.push("metering_under_voltage"),l&&r.warnings.push("metering_over_voltage"),p&&r.warnings.push("metering_low_power_factor"),t.power__W=e.getUint16(),t.voltage__V=e.getUint16(),void(t.power_factor=e.getUint8()/100);default:r.errors.push("invalid_header")}}function decodeFport49(e,t,r){switch(e.getUint8()){case 1:return void(t.packet_type="ldr_input_config_request");case 3:case 40:return void(t.packet_type="dig_input_config_request");case 7:return void(t.packet_type="status_config_request");case 9:return void(t.packet_type="time_config_packet");case 11:return void(t.packet_type="usage_config_request");case 13:return void(t.packet_type="boot_delay_config_request");case 21:return void(t.packet_type="onboard_led_config_request");case 22:return void(t.packet_type="metering_alert_confic_request");case 82:t.packet_type="multicast_config_request";var i=e.getUint8();return void(t.multicast_device=255===i?"all":i);case 32:return void(t.packet_type="calendar_config_request");case 33:t.packet_type="profile_config_request";var n=e.getUint8();return void(t.profile_id=255===n?"all_profiles":n);case 34:return void(t.packet_type="fade_config_request");case 35:return void(t.packet_type="holiday_config_request");case 36:return void(t.packet_type="dali_monitor_config_request");case 37:return void(t.packet_type="fallback_dim_config_request");case 38:return void(t.packet_type="location_config_request");case 39:return void(t.packet_type="lumalink_config_request");case 41:return void(t.packet_type="light_input_config_request");default:r.errors.push("invalid_header")}}function decodeFport51(e,t,r){switch(e.getUint8()){case 255:return void(t.packet_type="activate_dfu_command");case 254:return void(t.packet_type="restart_controller_command");default:r.errors.push("invalid_command")}}function decodeByFport(e,t,r,i){var n=new BinaryExtract(t);0===n.availableLen()?i.errors.push("empty_payload"):23===e?statusParser1_1(n,r,i):26===e?usageParser(n,r,i):49===e?decodeFport49(n,r,i):50===e?decodeFport50(n,r,i):51===e?decodeFport51(n,r,i):60===e?decodeFport60(n,r,i):61===e?decodeFport61(n,r,i):99===e?decodeFport99(n,r,i):i.errors.push("invalid_fport"),0!==n.availableLen()&&i.errors.push("invalid_payload_length_long")}function decodeRaw(e,t){var r={},i={errors:[],warnings:[]};try{decodeByFport(e,t,r,i)}catch(e){i.errors.push(e.message)}var n={data:r};return i.errors.length&&(n.errors=i.errors),i.warnings.length&&(n.warnings=i.warnings),n}function decodeDownlink(e){return decodeRaw(e.fPort,e.bytes)}function decodeUplink(e){return decodeRaw(e.fPort,e.bytes)}function Decoder(e,t){return decodeRaw(t,e)}function Decode(e,t){return decodeRaw(e,t)}BitExtract.prototype._assertOnRemainingLength=function(e){if(0===e)throw Error("invalid zero length bit field");if(this.offset+e>8)throw Error("invalid number of bits extracted")},BitExtract.prototype.getBits=function(e){this._assertOnRemainingLength(e);var t=Math.pow(2,e)-1,r=this.data>>this.offset&t;return this.offset+=e,1===e?Boolean(r):r},BinaryExtract.prototype.availableLen=function(){return this.buffer.length-this.offset},BinaryExtract.prototype._assertOnRemainingLength=function(e){if(e>this.availableLen())throw Error("invalid buffer length: too short")},BinaryExtract.prototype.getUint8=function(){return this._assertOnRemainingLength(1),this.buffer[this.offset++]},BinaryExtract.prototype.getInt8=function(){var e=this.getUint8();return e>127?e-256:e},BinaryExtract.prototype.getUint16=function(){return this._assertOnRemainingLength(2),this.buffer[this.offset++]+256*this.buffer[this.offset++]},BinaryExtract.prototype.getInt16=function(){var e=this.getUint16();return e>32767?e-65536:e},BinaryExtract.prototype.getUint24=function(){return this._assertOnRemainingLength(3),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]},BinaryExtract.prototype.getUint32=function(){return this._assertOnRemainingLength(4),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]+16777216*this.buffer[this.offset++]},BinaryExtract.prototype.getInt32=function(){var e=this.getUint32();return e>2147483647?e-4294967296:e},BinaryExtract.prototype.getUint64=function(){return this.getUint32()+4294967296*this.getUint32()},BinaryExtract.prototype.getTextUtf8=function(e){this._assertOnRemainingLength(e);var t=stringFromUTF8Array(this.buffer.slice(this.offset,this.offset+e));return this.offset+=e,t},BinaryExtract.prototype.getUint8Bits=function(){return new BitExtract(this.getUint8())},BinaryExtract.prototype.getRaw=function(e){this._assertOnRemainingLength(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},BinaryExtract.prototype.getFloat=function(){var e=this.getUint32(),t=2147483648&e?-1:1,r=(e>>23&255)-127,i=8388607&e;if(128===r)return t*(i?Number.NaN:Number.POSITIVE_INFINITY);if(-127===r){if(0===i)return 0*t;r=-126,i/=1<<22}else i=(i|1<<23)/(1<<23);return t*i*Math.pow(2,r)};
