function stringFromUTF8Array(e){for(var t=[1,1,1,1,2,2,3,0],r=e.length,n="",a=0;a<r;){var i=e[a++];if(128&i){var s=t[i>>3&7];if(!(64&i)||!s||a+s>r)return null;for(i&=63>>s;s>0;s-=1){var o=e[a++];if(128!=(192&o))return null;i=i<<6|63&o}}n+=String.fromCharCode(i)}return n}function BitExtract(e){this.data=e,this.offset=0}function BinaryExtract(e){this.buffer=e,this.offset=0}function pad(e,t){for(var r=""+e;r.length<t;)r="0"+r;return r}function intToHexStr(e,t){return pad(e.toString(16).toUpperCase(),t)}function objToList(e){var t=[];for(var r in e)void 0!==e[r]&&e[r]&&t.push(r);return t}function ln(e){return e&&e.length||0}function sNc(e,t){return t>0?Array(t+1).join(e):""}function sIn(e,t,r){return t?e.slice(0,t)+r+e.slice(t):r+e}function p10(e,t){if(!t)return e;var r=ln(e);if(!r){var n=parseInt(e);if(e!==n)return isNaN(n)?e:e*Math.pow(10,t)}var a=""+e,i=(r?"-"==r.charAt(0):e<0)?1:0,s=ln(a);return t>0?a+=sNc("0",t):((t+=s-i)<0&&(a=sIn(a,i,sNc("0",-t))),a=sIn(a,t<=0?i:t+i,".")),r?a:Number(a)}function ha2si(e){var t,r,n=ln(e=e.slice()),a=[],i=e[n-1],s=128&i;if(s)for(t=r=0;t<n;++t)(e[t]||r)&&(e[t]=256-e[t]-r,r=1);for(t=n,r=0;t;)e[--t]&&(r=1);if(!r)return 0;do{for(i=r=0,t=n;t;){var o=256*i+e[--t];i=o%10,(e[t]=(o-i)/10)&&(r=1)}a.push(i)}while(r);for(t=ln(a);!a[--t];);return(s?"-":"")+a.slice(0,++t).reverse().join("")}function i2s(e,t){var r=e?e.toString():"0",n=ln(r);return t?(n<t?sNc("0",t-n):"")+r:r}function sum(e,t,r){for(var n=0,a=t||0;a<(r||ln(e));)n+=e[a++];return 255&n}function parseHs(e){for(var t,r=e?e.split(/[\s,]/):[],n=[],a=0;a<ln(r);)ln(t=r[a++])&&(n=n.concat(t.match(/.{1,2}/g)));return n}function hs2i(e){return Number("0x"+e.replace(/^#/,""))}function hs2a(e){for(var t,r=parseHs(e),n=[],a=0;a<ln(r);){if(t=hs2i(r[a++]),isNaN(t)||t<0||t>255)throw'"'+r[a]+'" is not a hex byte, pos '+a;n.push(t)}return n}function b2hs(e){return((e=Number(e))<16?"0":"")+e.toString(16)}function ba2i(e){var t=ln(e);if(!t||t>4)return t?e:0;for(var r=e[--t],n=3==t?0:128&r?(r&=127,-(1<<8*t+7)):0;t>0;)r=(r<<8)+e[--t];return r+n}function ba2b(e){for(var t=ln(e),r=0;t;)r=(r<<8)+e[--t];return r}function ba2bcd(e,t){var r,n,a,i=0,s=ln(e),o="",u=0,c=0;function l(e){c&&(e=-e),e<10?o+=e:(u=1,o+="A-C EF".charAt(e-10))}for(;s;)n=(240&(r=e[--s]))>>4,a=15&r,c&&(n=-n,a=-a),i=100*i+10*n+a,l(n),1==ln(o)&&(u=0,13==n?u=1:n>13&&(c=1,i=a=-a,14==n&&(i-=10))),l(a);if(!t&&u)throw o;return u?o:i}function i2c(e){return String.fromCharCode(e)}function ba2s(e){for(var t=[],r=ln(e);r;)t.push(i2c(e[--r]));return t.join("")}function date(e,t,r){return{rawY:e,y:1900+e+(e<100?100:0),m:t,d:r,toString:function(){var e=this,n=i2s(r,2)+"."+i2s(t,2)+"."+e.y;return void 0!==e.hr&&(n+=" "+i2s(e.hr,2)+":"+i2s(e.mi,2)+(void 0!==e.se?":"+i2s(e.se,2):"")),e.s&&(n+=" (summer)"),e.i&&(n+=" (invalid)"),n}}}function i2d(e){return e?date(e>>5&7|e>>9&120,e>>8&15,31&e):null}function i2t(e){var t=ln(e)||0,r=t>5?1:0,n=r?e[--t]:0;if(!(e=t?ba2b(e.slice(r,t)):e))return null;var a=i2d(e>>16);return a.hr=e>>8&31,a.mi=63&e,r&&(a.se=63&n),32768&e&&(a.s=!0),128&e&&(a.i=!0),a}function ba2f(e){var t=ln(e)-1,r=7;if(7==t)r=4;else if(3!=t)return NaN;var n,a=t-1,i=(1<<r)-1,s=(e[a]&i)<<8*a,o=1<<8*a+r,u=1<<14-r,c=(e[a]>>r)+((127&e[t])<<8-r)+1-u,l=e[t]>>7?-1:1;for(n=0;n<a;++n)s+=e[n]<<8*n;return c==u?l*(s?NaN:Number.POSITIVE_INFINITY):(s&&(s=c==1-u?s/(o>>1):(s|o)/o),l*s*Math.pow(2,c))}function tmbus(e){for(var t=hs2a(e),r=Array.isArray,n=[0],a="Manufacturer specific",i="Reserved",s="Units for H.C.A.";ln(t)&&255==t[0];)t.splice(0,1);var o,u,c=ln(t),l=c-2,f={len:c},_=0,d=0;if(!c)return f;function p(e){throw(e||"Wrong frame length")+", pos "+d}function g(){return d==c&&p(),o=t[d++]}function m(e,r){var n=d,a=r+d;return a>l&&p("Premature end of data when reading "+e+" (need "+r+", available "+(l-d)+")"),d=a,t.slice(n,d)}function h(e,t,r){var n=m(e,r||4);return t?ba2i(2==t?n.reverse():n):ba2bcd(n,1)}function v(e){sum(t,e,l)!=t[l]&&p("Check sum failed")}if(g(),1==c)return 229==o?f.type="OK":p("Invalid char"),f;if(c<5&&p(),22!=t[c-1]&&p("No Stop"),16==o)return f.type="Short",v(1),f.c=g(),f.a=g(),f;if(104!=o&&p("No Start"),f.type="Data",f.l=g(),t[2]!=o&&p("Invalid length"),t[0]!=t[3]&&p("Invalid format"),o!=c-6&&p("Wrong length"),v(d=4),f.c=g(),f.a=g(),f.ci=g(),u=f.errors=[],114==(250&o))f.fixed=1==(1&o);else{f.type="Error";var y=["Unspecified error","Unimplemented CI-Field","Buffer too long, truncated","Too many records","Premature end of record","More than 10 DIFE's","More than 10 VIFE's",i,"Application too busy for handling readout request","Too many readouts"];if(112==o)return u.push(y[d==l?0:g()<10?o:7]),f;p(y[1])}f.id=h("ID");var b=" meter",w=["Heat"+b,"Cooling"+b," (Volume measured at ","return temperature: outlet)","flow temperature: inlet)","Customer unit","Radio converter ","Access Code "],B=["Other","Oil"+b,"Electricity"+b,"Gas"+b,w[0],"Steam"+b,"Hot water"+b,"Water"+b,"Heat Cost Allocator",i,w[0]+w[2]+w[3],"Compressed air",w[1]+w[2]+w[3],w[1]+w[2]+w[4],w[0]+w[2]+w[4],"Combined Heat / "+w[1],"Bus / System component","Unknown device type","Cold water"+b,"Dual water"+b,"Pressure"+b+" / pressure device","A/D Converter","Warm water"+b,"Calorific value","Smoke detector / smoke alarm device","Room sensor","Gas detector","Consumption"+b,"Sensor","Breaker (electricity)","Valve (gas or water)","Switching device",w[5]+" (display device)",w[5],"Waste water"+b,"Garbage","Carbon dioxide","Environmental"+b,"System device","Communication controller","Unidirectional repeater","Bidirectional repeater",w[6]+"(system side)",w[6]+"(meter side)","Wired Adapter"],U=[0,1,2,3,4,5,6,7,8,9,3,4,5,6,7,8,9],F=[0,1,2,3,10,5,22,7,8,11,12,13,14,15,16,17,27,27,27,27,23,6,18,19,20,21,24,25,26,28,28,28,29,30,31,31,31,32,33,33,34,35,36,37,37,37,37,37,38,39,40,41,38,38,42,43,44],k=["Instantaneous","Maximum","Minimum","During error state"];function x(e){return e<2?[["h,m,s","D,M,Y"][e],0]:e<56?[["Wh","kWh","MWh","kJ","MJ","GJ","W","kW","MW","kJ/h","MJ/h","GJ/h","ml","l","m³","ml/h","l/h","m³/h"][Math.floor((e-2)/3)],(e-2)%3]:e<57?["°C",-3]:e<58?[s,0]:[i,0]}function E(e){return i2c(64+(31&e))}function C(e){return E(e>>10)+E(e>>5)+E(e)}function P(e){return B[e>63?9:e>56?38:F[e]]}function S(e){var t=e.status;return e.fixed?e.cStored=2&t?"At fixed date":"Actual":3!=(3&t)&&(1&t&&u.push("Application Busy"),2&t&&u.push("Application Error")),4&t&&u.push("Power Low"),8&t&&u.push("Permanent Error"),16&t&&u.push("Temporary Error"),1&t}function I(){f.data||(f.data=[]);var e={id:_++};return f.data.push(e),e}function T(e,t){f.deviceCode=e,f.deviceType=t}function M(e){var r=ln(e);for(r=r?e[r-1]:128;d<l&&r>>7;)r=t[d++],e.push(r);return e}var D=["Reserved","Energy","Volume","Mass","On Time","Operating Time","Power","Volume Flow","Volume Flow ext.","Mass flow","Flow Temperature","Return Temperature","Temperature Difference","External Temperature","Pressure","Time Point",s,"Averaging Duration","Actuality Duration","Credit","Debit","Access Number","Medium","Manufacturer","Parameter set id","Model/Version","Hardware version #","Firmware version #","Software version #","Customer location","Customer",w[7]+"User",w[7]+"Operator",w[7]+"System Operator",w[7]+"Developer","Password","Error flags","Error mask","Digital Output","Digital Input","Baudrate","Response delay time","Retry","First cyclic storage #","Last cyclic storate #","Storage block size","Storage interval","Duration since last readout","Start of tariff","Duration of tariff","Period of tariff","Voltage","Current","Dimensionless","Reset counter","Cumulation counter","Control signal","Day of week","Week number","Time point of day change","State of parameter activation","Special supplier information","Duration since last cumulation","Operating time battery","Battery change","Cold/Warm Temperature Limit","Cumul. count max power"],A=["seconds","minutes","hours","days","months","years","Wh","J","m³","kg","W","J/h","m³/h","m³/min","m³/s","kg/h","°C","K","bar","currency unit","binary","baud","bittimes","V","A","MWh","GJ","t","feet³","american gallon","american gallon/min","american gallon/h","MW","GJ/h","°F","revolution / measurement","liter","kWh","kW","K*l"];function R(e,t,r){e.type=D[t[0]];var n=t[1];ln(t)>1&&(5==n&&(n=9,r+=2),9==n?e.unit=A[r]:8==n?(e.type+=" ("+(r?"time & ":"")+"date)",e.f=1==r?i2t:i2d):n>5?e.f=7==n?P:C:(e.unit=A[t[2]],e.e=r+t[1]))}function N(e,t){var a=t>>2&15,i=3&t;64&t&&(a=16+(7&a));var s=t>112?n:[[19,-3,19],[20,-3,19],[[21],[22,7],[23,6],[24]],[[25],[26],[27],[28]],[[29],[30],[31],[32]],[[33],[34],[35],[36,0,20]],[[37],n,[38,0,20],[39,0,20]],[[40,0,21],[41,0,22],[42],n],[[43],[44],[45],n],[46,9],[[46,0,4],[46,0,5],n,n],[47,9],[[48,8],[49,0,1],[49,0,2],[49,0,3]],[50,9],[[50,0,4],[50,0,5],[53],n],n,[[54],[55],[56],[57]],[[58],[59],[60],[61]],[62,5],[63,5],[[64,8]]][a];64==(96&t)?(i=15&t,s=(a=16&t)?[52,-12,24]:[51,-9,23]):r(s[0])&&(s=s[i],i=0),R(e,s,i)}function W(e,t){for(var a=7&t,i=[[[[1,-1,25]]],[[[1,-1,26]]],[[[2,2,8]]],[[[3,2,27]]],[[[n,[2,-1,28]],[[2,-1,29],[2,0,29]]],[[[7,-3,30],[7,0,30]],[[7,0,31],n]]],[[[6,-1,32]]],[[[6,-1,33]]],n,n,n,n,[[10,-3,34],[11,-3,34]],[[12,-3,34],[13,-3,34]],n,[[65,-3,34],[65,-3,16]],[66,-3,10]][t>>3&15],s=2;r(i[0]);a&=15^1<<s,i=t>>s--&1?ln(i)<1?n:i[1]:i[0]);R(e,i,a)}function L(e,t){var r,n=7&t,i="per ",s="multiplied by sek",o=2&n?"out":"in",u=8&t?"upper":"lower",c=4&t?"last":"first",l=1&t?"end":"begin",f="Duration of ",_=" limit exceed";(r=t<2?t?"Too many DIFE's":r:t<8?["Storage number","Unit number","Tariff number","Function","Data class","Data size"][n-2]+" not implemented":t<11?r:t<16?["Too many VIFE's","Illegal VIF-Group","Illegal VIF-Exponent","VIF/DIF mismatch","Unimplemented action"][n-3]:t<21?r:t<25?["No data available (undefined value)","Data overflow","Data underflow","Data error"][n-5]:t<28?"Premature end of record":t<32?r:t<39?i+A[n].slice(0,-1):t<40?i+A[35]:t<44?"increment per "+o+"put pulse on "+o+"put channel #"+(1&t):t<54?i+A[[36,8,9,17,37,26,38,39,23,24][t-44]]:t<55?s:t<57?s+" / "+A[24-(1&t)]:t<61?["start date(/time) of","VIF contains uncorrected unit instead of corrected unit","Accumulation only if positive contributions","Accumulation of abs value only if negative contributions"][n-1]:t<64?D[0]:t<74?n?"# of exceeds of "+u+" limit":u+" limit value":t<80?"Date (/time) of: "+l+" of "+c+" "+u+_:t<96?f+c+" "+u+_+", "+A[3&n]:t<104?f+c+", "+A[3&n]:t<112?2&n?"Date (/time) of "+c+" "+l:r:t<120?(e.e=n-6,r):t<124?"Additive correction constant: 10E"+(n-3)+"*"+e.type+" (offset)":t<125?r:t<126?(e.e=3,r):["future value",a+" data next"][1&n])&&e.typeE.push(r)}function V(e){var i,s=e.vif,o=ln(s),u=0,c=s[u],l=127,f=c&l;if(253==c||251==c?(253==c?N:W)(e,f=s[++u]&l):f<124?function(e,t){var a=t>>3&15,i=7&t,s=[[1,-3,6],[1,1,7],[2,-6,8],[3,-3,9],[[4,9],[5,9]],[6,-3,10],[6,1,11],[7,-6,12],[8,-7,13],[8,-9,14],[9,-3,15],[[10,-3,16],[11,-3,16]],[[12,-3,17],[13,-3,16]],[[14,-3,18],[[15,8],[[16],n]]],[[17,9],[18,9]]];if(15==a)i<3&&(e.type=["Fabrication No","(Enhanced)","Bus Address"][i]);else{for(var o=s[a],u=2;r(o[0]);i&=15^1<<u,o=o[t>>u--&1]);R(e,o,i)}}(e,f):124==f&&(i=t[(d-=o-2)-1],e.type=ba2s(m("VIF type",i)),o=ln(s=e.vif=M([c]))),f==l&&(e.type=a),s[u]>>7){for(f!=l&&++u,e.typeE=[],i=0;u<o&&u<11&&(f=(c=s[u++])&l,i?e.typeE.push(f):(i=f==l,L(e,f)),128&c););ln(e.typeE)||delete e.typeE}}function O(e){V(e);var r,n,a,i,s,o=e.dif,u=ln(o)-1,c=o[0],l=c>>4&3,f=15&c,_=7&c;if(13==f?(r=_=t[d++],_<192?a=ba2s:(_&=15,r>239?r<251&&(a=ba2f):(a=r>223?ba2i:ba2bcd,s=208==(240&r)))):5==_?(--_,a=ba2f):(7==_&&++_,a=8&f?ba2bcd:ba2i),n=f=m("Record #"+e.id,_),a)try{f=a(f)}catch(t){e.error=!0,f=t}if(e.error||(e.f&&(f=e.f(f)),(a=Array.isArray(f))&&(f=ha2si(f)),s&&(f=a?"-"==f.charAt(0)?f.slice(1):"-"+f:-f),e.e&&(f=p10(f,e.e))),e.value=f,e.rawValue=n,e.func=k[l],l=1&(c>>=6),n=f=i=0,2&c){for(;n<u;++n)i+=((c=o[n+1])>>6&1)<<n,f+=(c>>4&3)<<2*n,l+=(15&c)<<4*n+1;e.device=i,e.tariff=f}e.storage=l,delete e.f,delete e.e}return f.fixed?function(){f.accessN=g(),f.status=g();var e=S(f),t=g(),r=g(),n=t>>6|r>>4&12;T(n,B[U[n]]),n>9&&n<15&&e&&(e=2);var a,i=I(),s=I(),o=x(63&t),u=63&r,c=1;i.storage=0,i.func=k[0],i.value=p10(h("Counter 1",e),o[1]),i.unit=o[0],62==u?a=o:(c=0,63!=u&&(a=x(u))),s.storage=c,s.func=k[0],c=h("Counter 2",e),s.value=a?p10(c,a[1]):c,s.unit=a?a[0]:""}():function(){for(f.manId=C(h("ManID",1,2)),f.version=g(),g(),T(o,P(o)),f.accessN=g(),f.status=g(),S(f),d+=2;d<l-1;){var e=t[d],r=47==e?r:I();15==(15&e)?(++d,(e=e>>4&7)<2?(e&&(r.request="Readout again"),r.type=a,r.value=m(r.type,l-d)):e>6&&(r.request="Global readout")):(r.dif=M([]),r.vif=M([]),O(r))}}(),f}function _ba2hs(e,t){for(var r=[],n=0;n<ln(e);)r.push(b2hs(e[n++]));return r.join(t||"")}function invoke_tmbus(e){var t=ln(e)+21,r=[104,t-6,t-6,104,8,2,114,120,86,52,18,36,64,1,7,85,0,0,0].concat(Array.from(e)),n=sum(r,4,t-2);r.push(n,22);var a=tmbus(_ba2hs(r));return{data:a.data,errors:a.errors}}function convert_units(e){return e=(e=(e=(e=(e=e.replace(/\s+/g,"")).replace(" ","_")).replace("/","_per_")).replace("³","3")).replace("°","deg")}function convert_time_to_iso(e){var t=e.y+"-"+pad(e.m,2)+"-"+pad(e.d,2);return e.hr&&(t+="T"+pad(e.hr,2)+":"+pad(e.mi,2)),t}function convert_datarecords(e){var t={};for(var r of e){var n=r.storage,a="";n>0&&(a="storage"+n+"_");var i=r.type.replace(/\s+/g,"_").replace(/_\(.*?\)/g,""),s="";if(r.typeE)for(let e=0;e<r.typeE.length;e++)if(r.typeE[e]&&""!==r.typeE[e].trim()){let t=r.typeE[e];const n={"VIF contains uncorrected unit":"_VIF","Accumulation only if positive contributions":"_accumulated_pos","Accumulation of abs value only if negative contributions":"_Accumulated_neg"};for(const e in n)t=t.replace(e,n[e]);console.log(`Value ${e+1}: ${t}`),s=t}var o="";r.func&&(o={Instantaneous:"",Maximum:"_max",Minimum:"_min","During error state":"_during_error"}[r.func]);var u="";r.tariff&&(u="tariff"+r.tariff+"_");var c="";r.device&&(c="subunit"+r.device+"_");var l=r.value;r.type.includes("Time Point")&&(l=convert_time_to_iso(l));var f="";if(r.unit&&(f="__"+convert_units(r.unit),"binary"==r.unit)){var _=15&r.dif[0];l="0x"+intToHexStr(r.value,2*_)}var d=[a,c,u,i,s,o].filter((e=>void 0!==e)).join("").toLowerCase();d=d.replace("__","_"),t[d+=f]=l}return t}function decode_mbus(e){return convert_datarecords(invoke_tmbus(e).data)}function byte_arr_2_hex(e){for(var t=[],r=0;r<ln(e);)t.push(b2hs(e[r++]));return t.join("")}function mbusStatus(e,t){switch(e){case 0:return"connected";case 1:return"nothing_requested";case 2:return"bus_unpowered";case 3:return"no_response";case 5:return"crc_or_len_error";case 6:return"parse_error";case 7:return"bus_shorted";default:return t.errors.push("invalid_mbus_status"),"invalid_mbus_status"}}function usagePulseMediumType(e,t){switch(e){case 0:return"triggers";case 1:return"pulses";case 2:return"L_water";case 3:return"Wh_electricity";case 4:return"L_gas";default:return t.errors.push("invalid_medium"),"invalid_medium"}}function serialFormat(e){return 4294967295===e?"not_available":intToHexStr(e,8)}function actualityDurationToMinutesFormat(e){return e<60?e:e<156?15*(e-60):e<200?24*(e-156)*60:e<253?7*(e-200)*24*60:253===e?525600:null}function actualityDurationToFormatStr(e){var t=actualityDurationToMinutesFormat(e);return e<60?t+" minutes":e<156?(t/60).toFixed(2)+" hours":e<200?(t/1440).toFixed(2)+" days":e<253?(t/10080).toFixed(2)+" weeks":253===e?(t/525600).toFixed(2)+" years":null}function usagePulseMultiplier(e){switch(e){case 0:return 1;case 1:return 10;case 2:return 100;case 3:return 1e3;default:throw Error("invalid_multiplier")}}function pulseInputModeAndUnit(e,t){switch(e){case 0:return"disabled";case 1:return"pulses";case 2:return"L_water";case 3:return"Wh_electricity";case 4:return"L_gas";case 9:return"triggers_1_sec";case 10:return"triggers_10_sec";case 11:return"triggers_1_min";case 12:return"triggers_1_h";default:throw t.errors.push("invalid_input_mode"),Error("invalid_input_mode")}}function lorawanProfileFormat(e,t){switch(e){case 0:return"lorawan_disabled";case 1:return"lorawan_24_h_privacy";case 2:return"lorawan_24_h";case 3:return"lorawan_12_h";case 7:return"lorawan_1_h_static";case 8:return"lorawan_15_min_static";case 23:return"lorawan_1_h_dynamic";case 24:return"lorawan_15_min_dynamic";default:return t.errors.push("invalid_lorawan_profile"),"invalid_lorawan_profile"}}function wmbusProfileFormat(e,t){switch(e){case 0:return"wmbus_disabled";case 1:return"wmbus_privacy";case 2:return"wmbus_driveby";case 3:return"wmbus_fixnet";default:return t.errors.push("invalid_wmbus_profile"),"invalid_wmbus_profile"}}function packetErrorReasonFormatter(e,t){switch(e){case 0:case 1:return"n/a";case 2:return"unknown_fport";case 3:return"packet_size_short";case 4:return"packet_size_long";case 5:return"value_error";case 6:return"protocol_parse_error";case 7:return"reserved_flag_set";case 8:return"invalid_flag_combination";case 9:return"unavailable_feature_request";case 10:return"unsupported_header";case 11:return"unreachable_hw_request";case 12:return"address_not_available";case 13:return"internal_error";default:return t.errors.push("invalid_error_code"),"invalid_error_code"}}function hardwareConfigFormat(e,t){switch(e){case 0:return"pulse_only";case 1:return"pulse_analog";case 2:return"pulse_ssi";case 4:return"pulse_mbus";case 6:return"pulse_lbus";case 7:return"pulse_izar";default:return t.errors.push("invalid_hardware_config"),"invalid_hardware_config"}}function shutdownReasonFormat(e,t){switch(e){case 50:return"enter_dfu";case 51:return"app_shutdown";case 52:return"switch_to_wmbus";default:return t.errors.push("invalid_shutdown_reason"),"invalid_shutdown_reason"}}function bootPacketReason(e,t){switch(e){case 0:return"unknown_reset";case 1:return"from_shutdown";case 2:return"from_dfu";case 3:return"froced_reset";case 4:return"lorawan_rejoin";default:return t.errors.push("invalid_boot_packet_reason"),"invalid_boot_packet_reason"}}function mbusMedium(e){switch(e){case 0:return"other";case 1:return"oil";case 2:return"electricity";case 3:return"gas";case 4:return"heat (outlet vol)";case 5:return"steam";case 6:return"hot Water";case 7:return"water";case 8:return"heat cost allocator";case 9:return"compressed air";case 10:case 11:return"cooling load meter";case 12:return"heat (inlet vol)";case 13:return"heat / cooling load meter";case 14:return"bus / system";case 15:default:return"unknown";case 22:return"cold water";case 23:return"dual water";case 24:return"pressure";case 25:return"A/D converter"}}function mbusManufacturer(e){var t=String.fromCharCode(64+(e>>10&31));return t+=String.fromCharCode(64+(e>>5&31)),t+=String.fromCharCode(64+(31&e))}function ssiSensor(e,t){switch(e){case 0:return"disconnected";case 1:return"pressure_30bar_temperature";default:return t.errors.push("unknown_sensor_index"),"unknown_sensor_index"}}function pulseUsageParse(e,t){var r={},n=e.getUint8Bits();r.input_state=!0===n.getBits(1)?"closed":"open";var a=n.getBits(1),i=usagePulseMultiplier(n.getBits(2));r.muliplier=i;var s=usagePulseMediumType(n.getBits(4),t);return r.medium_type=s,r["accumulated__"+s]=e.getUint32()*i,a&&(r.serial=serialFormat(e.getUint32())),r}function usageAndStatusParser(e,t,r){var n={},a={},i=new BinaryExtract(e),s=!1,o=i.getUint8();if(2===o)t.packet_type="usage_packet";else{if(130!==o)return void r.errors.push("invalidpacket_type "+o);t.packet_type="status_packet",s=!0}var u=i.getUint8Bits(),c={};if(c.pulse_1_trigger_alert=u.getBits(1),c.pulse_2_trigger_alert=u.getBits(1),u.getBits(4),c.low_battery=u.getBits(1),t.app_connected_within_a_day=u.getBits(1),t.active_alerts=c,s){t.battery_remaining__years=parseFloat((i.getUint8()/12).toFixed(1)),t.battery_voltage__V=i.getUint8()/100+1.5,t.internal_temperature__C=i.getInt8();var l=i.getUint8Bits();t.internal_temperature_min__C=-2*l.getBits(4)+t.internal_temperature__C,t.internal_temperature_max__C=2*l.getBits(4)+t.internal_temperature__C,t.radio_downlink_rssi__dBm=-1*i.getUint8();var f=i.getUint8Bits();t.radio_downlink_snr__dB=2*f.getBits(4)-20,t.radio_uplink_power__dBm=2*f.getBits(4)}var _=i.getUint8();t.meter_actuality_duration__minutes=actualityDurationToMinutesFormat(_),t.meter_actuality_duration_formatted=actualityDurationToFormatStr(_);var d=i.getUint8Bits(),p=d.getBits(1),g=d.getBits(1),m=d.getBits(4),h=8===m,v=4===m;if(p&&(t.pulse_1=pulseUsageParse(i,r)),g&&(t.pulse_2=pulseUsageParse(i,r)),h){var y=i.getUint8Bits();n.last_bus_status=mbusStatus(y.getBits(4),r),n.records_truncated=y.getBits(1);var b=y.getBits(1),w=y.getBits(1);b&&(n.status="0x"+intToHexStr(i.getUint8(),2),n.serial=serialFormat(i.getUint32())),w&&(n.manufacturer=mbusManufacturer(i.getUint16()),n.version=i.getUint8(),n.medium=mbusMedium(i.getUint8()));var B=i.getRaw(i.availableLen());n.data_records_raw=byte_arr_2_hex(B).toUpperCase(),n.data_records={};var U=decode_mbus(B);for(var F in U)n.data_records[F]=U[F];t.mbus=n}if(v){var k=i.getUint8Bits();a.sensor=ssiSensor(k.getBits(6),r);var x=i.getUint8Bits(),E=x.getBits(1),C=x.getBits(1),P=x.getBits(1),S=x.getBits(1),I=x.getBits(1),T=x.getBits(1),M=x.getBits(1),D=x.getBits(1);E&&(a.channel_1=parseFloat(i.getFloat().toFixed(5))),C&&(a.channel_1_avg=parseFloat(i.getFloat().toFixed(5))),P&&(a.channel_2=parseFloat(i.getFloat().toFixed(5))),S&&(a.channel_2_avg=parseFloat(i.getFloat().toFixed(5))),I&&(a.channel_3=parseFloat(i.getFloat().toFixed(5))),T&&(a.channel_3_avg=parseFloat(i.getFloat().toFixed(5))),M&&(a.channel_4=parseFloat(i.getFloat().toFixed(5))),D&&(a.channel_4_avg=parseFloat(i.getFloat().toFixed(5))),t.ssi=a}}function pulseConfigParse(e,t){var r={};r.input_mode_and_unit=pulseInputModeAndUnit(e.getUint8Bits().getBits(4),t);var n=e.getUint8Bits(),a=n.getBits(1),i=n.getBits(1),s=n.getBits(1),o=n.getBits(1);n.getBits(2);var u=usagePulseMultiplier(n.getBits(2));return a&&(r.multiplier_numerator=e.getUint16(),r.multiplier_denominator=e.getUint8()),i&&(r.accumulated_absolute=e.getUint32()*u),s&&(r.accumulated_offset=e.getInt32()*u),o&&(r.serial=serialFormat(e.getUint32())),r}function generalConfigurationParser(e,t,r){var n=new BinaryExtract(e),a=n.getUint8();if(18===a){t.packet_type="general_configuration_packet";var i=n.getUint8Bits(),s=i.getBits(1),o=i.getBits(1);i.getBits(2);var u=i.getBits(1),c=i.getBits(1);s&&(t.radio_lorawan_profile=lorawanProfileFormat(n.getUint8(),r)),o&&(t.radio_wmbus_profile=wmbusProfileFormat(n.getUint8(),r)),u&&(t.pulse_1=pulseConfigParse(n,r)),c&&(t.pulse_2=pulseConfigParse(n,r))}else r.errors.push("invalid_configuration_type "+a)}function mbusConfigurationParser(e,t,r){var n=new BinaryExtract(e),a=n.getUint8();if(20===a){t.packet_type="mbus_configuration_packet";var i=n.getUint8Bits(),s=i.getBits(4),o=i.getBits(4);if(s>10||o>10)r.errors.push("invalid_usage_or_status_count");else for(t.mbus_data_record_header_raw="";n.offset<n.buffer.length;)t.mbus_data_record_header_raw+=intToHexStr(n.getUint8(),2)}else r.errors.push("invalid_configuration_type "+a)}function locationConfigurationParser(e,t,r){var n=new BinaryExtract(e),a=n.getUint8();if(33===a){t.packet_type="location_configuration_packet";var i={},s=n.getUint8Bits();if(i.gps_position_sent=s.getBits(1),i.time_zone_sent=s.getBits(1),i.address_sent=s.getBits(1),i.id_customer_sent=s.getBits(1),i.id_location_sent=s.getBits(1),i.gps_position_sent&&(t.gps_position_latitude__deg=n.getInt32()/1e7,t.gps_position_longitude__deg=n.getInt32()/1e7),i.time_zone_sent&&(t.time_zone__h=n.getInt8()/4),i.address_sent){var o=n.getUint8();t.address=n.getTextUtf8(o)}if(i.id_customer_sent){var u=n.getUint8();t.id_customer=n.getTextUtf8(u)}if(i.id_location_sent){var c=n.getUint8();t.id_location=n.getTextUtf8(c)}}else r.errors.push("invalid_configuration_type "+a)}function configurationRequestsParser(e,t,r){var n=new BinaryExtract(e).getUint8();18===n?t.packet_type="general_configuration_request":20===n?t.packet_type="mbus_configuration_request":33===n?t.packet_type="location_configuration_request":r.errors.push("invalid_request_type "+n)}function commandParser(e,t,r){var n=new BinaryExtract(e),a=n.getUint8();if(3===a){if(1===e.length)return void(t.packet_type="local_time_request");t.packet_type="local_time_response",t.device_local_time__s=n.getUint32();var i=new Date(1e3*t.device_local_time__s);t.device_local_time_formatted=i.toISOString().replace(/.\d+Z$/g,"Z");t.device_local_time__s<1577836800&&(t.device_local_time_formatted="invalid")}else if(129===a){if(1===e.length)return void(t.packet_type="mbus_available_data_records_request");t.packet_type="mbus_available_data_records";var s=n.getUint8Bits();if(t.packet_number=s.getBits(3),t.more_packets_following=s.getBits(1),s.getBits(2),s.getBits(1)){t.mbus_header={},t.mbus_header.serial=serialFormat(n.getUint32()),t.mbus_header.manufacturer=mbusManufacturer(n.getUint16()),t.mbus_header.version="0x"+intToHexStr(n.getUint8(),2),t.mbus_header.medium=mbusMedium(n.getUint8()),t.mbus_header.access_number=n.getUint8(),t.mbus_header.status="0x"+intToHexStr(n.getUint8(),2);var o=intToHexStr(n.getUint8(),2),u=intToHexStr(n.getUint8(),2);t.mbus_header.signature=o+u}for(t.mbus_data_record_header_raw="";n.offset<n.buffer.length;)t.mbus_data_record_header_raw+=intToHexStr(n.getUint8(),2)}else 255===a?t.packet_type="enter_dfu_command":r.errors.push("invalid_command_type "+a)}function sysMessagesParser(e,t,r){var n=new BinaryExtract(e),a=n.getUint8();if(19===a)t.packet_type="faulty_downlink_packet",t.packet_fport=n.getUint8(),t.packet_error_reason=packetErrorReasonFormatter(n.getUint8(),r),r.warnings.push("faulty_downlink_packet "+t.packet_error_reason);else if(0===a){t.packet_type="boot_packet",t.device_serial=serialFormat(n.getUint32()),t.device_firmware_version=n.getUint8().toString()+"."+n.getUint8()+"."+n.getUint8();var i=n.getUint8Bits(),s={};s.reason_0=i.getBits(1),s.watchdog_reset=i.getBits(1),s.soft_reset=i.getBits(1),s.reason_3=i.getBits(1),s.magnet_wakeup=i.getBits(1),s.reason_5=i.getBits(1),s.reason_6=i.getBits(1),s.nfc_wakeup=i.getBits(1),t.wakeup_reason_mcu=objToList(s);var o=n.getUint8Bits();o.getBits(4),t.packet_reason=bootPacketReason(o.getBits(3),r),t.configuration_restored=o.getBits(1),t.hardware_configuration=hardwareConfigFormat(n.getUint8(),r),t.device_uptime_accumulated__days=parseFloat((n.getUint24()/24).toFixed(2))}else if(1===a){var u=shutdownReasonFormat(n.getUint8(),r);usageAndStatusParser(e.slice(2),t),t.packet_type="shutdown_packet",t.shutdown_reason=u}else r.errors.push("invalid_command_type "+a)}function checkFport(e,t,r){e!==t&&r.errors.push("wrong fport or header")}function decodeByPacketHeader(e,t,r,n){0===t.length?n.errors.push("empty_payload"):2===t[0]?(usageAndStatusParser(t,r,n),checkFport(e,25,n)):130===t[0]?(usageAndStatusParser(t,r,n),checkFport(e,24,n)):18===t[0]?1===t.length?(configurationRequestsParser(t,r,n),checkFport(e,49,n)):(generalConfigurationParser(t,r,n),checkFport(e,50,n)):33===t[0]?1===t.length?(configurationRequestsParser(t,r,n),checkFport(e,49,n)):(locationConfigurationParser(t,r,n),checkFport(e,50,n)):20===t[0]?1===t.length?(configurationRequestsParser(t,r,n),checkFport(e,49,n)):(mbusConfigurationParser(t,r,n),checkFport(e,50,n)):3===t[0]||129===t[0]||255===t[0]?(commandParser(t,r,e),1===t.length||3===t[0]?checkFport(e,60,n):checkFport(e,61,n)):0===t[0]||1===t[0]||19===t[0]?(sysMessagesParser(t,r,n),checkFport(e,99,n)):n.errors.push("invalid_packet_type")}function decodeRaw(e,t){var r={},n={errors:[],warnings:[]};try{decodeByPacketHeader(e,t,r,n)}catch(e){n.errors.push("decoder_error "+e.message)}return{data:r,errors:n.errors,warnings:n.warnings}}function decodeDownlink(e){return decodeRaw(e.fPort,e.bytes)}function decodeUplink(e){return decodeRaw(e.fPort,e.bytes)}function Decoder(e,t){return decodeRaw(t,e)}function Decode(e,t){return decodeRaw(e,t)}BitExtract.prototype._assertOnRemainingLength=function(e){if(0===e)throw Error("invalid zero length bit field");if(this.offset+e>8)throw Error("invalid number of bits extracted")},BitExtract.prototype.getBits=function(e){this._assertOnRemainingLength(e);var t=Math.pow(2,e)-1,r=this.data>>this.offset&t;return this.offset+=e,1===e?Boolean(r):r},BinaryExtract.prototype.availableLen=function(){return this.buffer.length-this.offset},BinaryExtract.prototype._assertOnRemainingLength=function(e){if(e>this.availableLen())throw Error("invalid buffer length: too short")},BinaryExtract.prototype.getUint8=function(){return this._assertOnRemainingLength(1),this.buffer[this.offset++]},BinaryExtract.prototype.getInt8=function(){var e=this.getUint8();return e>127?e-256:e},BinaryExtract.prototype.getUint16=function(){return this._assertOnRemainingLength(2),this.buffer[this.offset++]+256*this.buffer[this.offset++]},BinaryExtract.prototype.getInt16=function(){var e=this.getUint16();return e>32767?e-65536:e},BinaryExtract.prototype.getUint24=function(){return this._assertOnRemainingLength(3),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]},BinaryExtract.prototype.getUint32=function(){return this._assertOnRemainingLength(4),this.buffer[this.offset++]+256*this.buffer[this.offset++]+65536*this.buffer[this.offset++]+16777216*this.buffer[this.offset++]},BinaryExtract.prototype.getInt32=function(){var e=this.getUint32();return e>2147483647?e-4294967296:e},BinaryExtract.prototype.getUint64=function(){return this.getUint32()+4294967296*this.getUint32()},BinaryExtract.prototype.getTextUtf8=function(e){this._assertOnRemainingLength(e);var t=stringFromUTF8Array(this.buffer.slice(this.offset,this.offset+e));return this.offset+=e,t},BinaryExtract.prototype.getUint8Bits=function(){return new BitExtract(this.getUint8())},BinaryExtract.prototype.getRaw=function(e){this._assertOnRemainingLength(e);var t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t},BinaryExtract.prototype.getFloat=function(){var e=this.getUint32(),t=2147483648&e?-1:1,r=(e>>23&255)-127,n=8388607&e;if(128===r)return t*(n?Number.NaN:Number.POSITIVE_INFINITY);if(-127===r){if(0===n)return 0*t;r=-126,n/=1<<22}else n=(n|1<<23)/(1<<23);return t*n*Math.pow(2,r)};
